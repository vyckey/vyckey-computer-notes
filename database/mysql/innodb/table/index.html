<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-database docs-version-current docs-doc-page docs-doc-id-mysql/innodb/table" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">表 | Vyckey Computer Notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="http://hoily.site/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="http://hoily.site/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="http://hoily.site/database/mysql/innodb/table"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-database-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-database-current"><meta data-rh="true" property="og:title" content="表 | Vyckey Computer Notes"><meta data-rh="true" name="description" content="逻辑存储结构"><meta data-rh="true" property="og:description" content="逻辑存储结构"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://hoily.site/database/mysql/innodb/table"><link data-rh="true" rel="alternate" href="http://hoily.site/database/mysql/innodb/table" hreflang="en"><link data-rh="true" rel="alternate" href="http://hoily.site/database/mysql/innodb/table" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Vyckey Computer Notes RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Vyckey Computer Notes Atom Feed"><link rel="stylesheet" href="/assets/css/styles.500dd4b8.css">
<script src="/assets/js/runtime~main.f9b04792.js" defer="defer"></script>
<script src="/assets/js/main.02b7b6d4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.jpeg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.jpeg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Vyckey Notes</b></a><a class="navbar__item navbar__link" href="/docs/">Computer</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/database">Database</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/database/mysql">MySQL</a></li><li><a class="dropdown__link" href="/database/redis">Redis</a></li><li><a class="dropdown__link" href="/database/elasticsearch">ES</a></li></ul></div><a class="navbar__item navbar__link" href="/java">Java</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/middleware">Middleware</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/middleware/rpc/dubbo">Dubbo</a></li><li><a class="dropdown__link" href="/middleware/mq/kafka">Kafka</a></li></ul></div><a class="navbar__item navbar__link" href="/bigdata">Bigdata</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/ai">AI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/ai/deeplearning/transformer">Transformer</a></li><li><a class="dropdown__link" href="/ai/deeplearning/models">Models</a></li></ul></div><a class="navbar__item navbar__link" href="/frontend">Frontend</a><a class="navbar__item navbar__link" href="/material">Material</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/vyckey/vyckey-computer-notes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/database/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/database/mysql/">MySQL</a><button aria-label="Collapse sidebar category &#x27;MySQL&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/database/mysql/file/">File</a><button aria-label="Expand sidebar category &#x27;File&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/database/mysql/index/">Index</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/database/mysql/transaction/">Transaction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/database/mysql/innodb/table">innodb</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/database/mysql/innodb/table">Table</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/database/mysql/innodb/transaction">Transaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/database/mysql/innodb/lock">Lock</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/database/mysql/sql/performance">sql</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/database/elasticsearch/">ElasticSearch</a><button aria-label="Expand sidebar category &#x27;ElasticSearch&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/database/redis/">Redis</a><button aria-label="Expand sidebar category &#x27;Redis&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/database/neo4j/">Neo4j</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/database/janusgraph/">Janusgraph</a><button aria-label="Expand sidebar category &#x27;Janusgraph&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/database/mysql/"><span itemprop="name">MySQL</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">innodb</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Table</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>InnoDB表</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="逻辑存储结构">逻辑存储结构<a href="#逻辑存储结构" class="hash-link" aria-label="Direct link to 逻辑存储结构" title="Direct link to 逻辑存储结构">​</a></h2>
<p>InnoDB存储引擎中，所有数据都被逻辑存放在一个空间中，成为表空间。表空间又段（segment）、区（extent）、页（page）、行（row）多级组成。</p>
<ul>
<li>段（segment）：常见的有数据段、索引段、回滚段等。</li>
<li>区（extent）：区的大小一般为1MB。</li>
<li>页（page）：也成为块block。默认大小为16KB，也就是一个区有64个页。页的大小可以通过 <code>innodb_page_size</code> 参数来指定。常见的页类型有：数据页、undo页、系统页、事务数据页、插入缓冲位图页、插入缓冲空闲列表页、未压缩的二进制大对象页、压缩的二进制大对象页等。</li>
<li>行（row）：InnoDB引擎按行存储数据。</li>
</ul>
<p><img decoding="async" loading="lazy" alt="InnoDB逻辑存储结构" src="/assets/images/innodb_table_space-0916b740af3de1e4e6596ea47e36e998.png" width="783" height="675" class="img_ev3q"></p>
<p>默认情况下所有表都存放到共享表空间中，用户可以启用 <code>innodb_file_per_table</code> 参数让每张表的数据单独存放到一个表空间中，需要注意的是，每张表的表空间只存放数据、索引和插入缓冲Bitmap页，其他数据，例如回滚日志、插入缓冲索引页、系统事务信息、二次写缓冲等还是存放到共享表空间中。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="行存储方式">行存储方式<a href="#行存储方式" class="hash-link" aria-label="Direct link to 行存储方式" title="Direct link to 行存储方式">​</a></h2>
<p>MySQL默认在版本5.0之前采用 Redundant 的行格式，5.0以及之后5.7之前采用 Compact 行格式，5.7之后采用Dynamic 行格式。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="redundant行格式">Redundant行格式<a href="#redundant行格式" class="hash-link" aria-label="Direct link to Redundant行格式" title="Direct link to Redundant行格式">​</a></h3>
<p>Redundant行格式是在MySQL5.0版本之前的行记录存储格式。</p>
<table style="border:none"><tbody><td style="background:red;color:white">字段长度偏移列表</td><td style="background:blue;color:white">记录头信息</td><td style="background:green;color:white">隐藏列</td><td style="background:pink;color:white">不为NULL值的列值</td></tbody></table>
<ul>
<li>字段偏移列表（1-n字节）：当列长度小于255字节，用1个字节表示，大于255字节，使用2个字节表示。列长度顺序逆序放置。注意字段包含定长类型字段，且存储的是偏移位置，不是列长度。</li>
<li>NULL标识位（1-n字节）：为NULL则置bit位为1，否则为0。</li>
<li>记录头信息（6字节）：记录行的一些特征信息。</li>
<li>row_id（6字节）：如果表没有定义主键时存在，否则不存在。</li>
<li>trx_id（6字节）：事务ID。</li>
<li>roll_ptr（7字节）：回滚指针。</li>
<li>不为NULL值的列值：非NULL的列值，占用字节由类型决定。</li>
</ul>
<table><thead><tr><th style="text-align:center">名称</th><th style="text-align:center">大小 / bit</th><th>描述</th></tr></thead><tbody><tr><td style="text-align:center">-</td><td style="text-align:center">1</td><td>未知</td></tr><tr><td style="text-align:center">-</td><td style="text-align:center">1</td><td>未知</td></tr><tr><td style="text-align:center">deleted_flag</td><td style="text-align:center">1</td><td>该行是否已被删除</td></tr><tr><td style="text-align:center">min_rec_flag</td><td style="text-align:center">1</td><td>该记录是否预先被定义为最小记录</td></tr><tr><td style="text-align:center">n_owned</td><td style="text-align:center">4</td><td>该记录拥有的记录数</td></tr><tr><td style="text-align:center">heap_no</td><td style="text-align:center">13</td><td>索引堆中该记录的排序记录</td></tr><tr><td style="text-align:center">n_fields</td><td style="text-align:center">10</td><td>记录中列的数量</td></tr><tr><td style="text-align:center">1byte_offs_flags</td><td style="text-align:center">1</td><td>偏移列表为1字节还是2字节</td></tr><tr><td style="text-align:center">next_record</td><td style="text-align:center">16</td><td>页中下一条记录的相对位置</td></tr></tbody></table>
<p>对于VARCHAR类型的NULL值，该格式不占用列存储空间，但是CHAR类型的NULL值需要占用空间。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="compact行格式">Compact行格式<a href="#compact行格式" class="hash-link" aria-label="Direct link to Compact行格式" title="Direct link to Compact行格式">​</a></h3>
<p>Compact行记录是在MySQL5.0版本引入的。</p>
<table style="border:none"><tbody><td style="background:red;color:white">变长字段长度列表</td><td style="background:blue;color:white">NULL标识位</td><td style="background:green;color:white">记录头信息</td><td style="background:gray;color:white">row_id</td><td style="background:gray;color:white">trx_id</td><td style="background:gray;color:white">roll_ptr</td><td style="background:pink;color:white">不为NULL值的列值</td></tbody></table>
<ul>
<li>变长字段长度列表（1-n字节）：只包含变长字段长度，逆序存储每个变长列的长度。变长字段指的是VARCHAR类型的列。当列长度小于255字节，用1个字节表示，大于255字节，使用2个字节表示。列长度顺序逆序放置。</li>
<li>NULL标识位（1-n字节）：为NULL则置bit位为1，否则为0。存储顺序也是逆序。</li>
<li>记录头信息（5字节）：记录行的一些特征信息。</li>
<li>row_id（6字节）：如果表没有定义主键时存在，否则不存在。</li>
<li>trx_id（6字节）：事务ID。</li>
<li>roll_ptr（7字节）：回滚指针。</li>
<li>不为NULL值的列值：非NULL的列值，占用字节由类型决定。</li>
</ul>
<table><thead><tr><th style="text-align:center">名称</th><th style="text-align:center">大小 / bit</th><th>描述</th></tr></thead><tbody><tr><td style="text-align:center">-</td><td style="text-align:center">1</td><td>未知</td></tr><tr><td style="text-align:center">-</td><td style="text-align:center">1</td><td>未知</td></tr><tr><td style="text-align:center">deleted_flag</td><td style="text-align:center">1</td><td>该行是否已被删除</td></tr><tr><td style="text-align:center">min_rec_flag</td><td style="text-align:center">1</td><td>该记录是否预先被定义为最小记录</td></tr><tr><td style="text-align:center">n_owned</td><td style="text-align:center">4</td><td>该记录拥有的记录数</td></tr><tr><td style="text-align:center">heap_no</td><td style="text-align:center">13</td><td>索引堆中该记录的排序记录</td></tr><tr><td style="text-align:center">record_type</td><td style="text-align:center">3</td><td>记录类型，000表示普通，001表示B+树节点指针，010表示Infimum最小记录，011表示Supermum最大记录，1xx表示保留</td></tr><tr><td style="text-align:center">next_record</td><td style="text-align:center">16</td><td>页中下一条记录的相对位置</td></tr></tbody></table>
<p>该格式下，VARCHAR类型和CHAR类型的列值都不会额外占用空间。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>为什么「变长字段长度列表」的信息要逆序存放？</div><div class="admonitionContent_BuS1"><p>变长字段的数据占用字节数之所以会按列的顺序<strong>逆序存放</strong>，是因为，一方面记录头信息中指向下一记录的指针指向的是记录头信息和真实数据之前的位置，好处是向左读就是记录头的信息，向右读就是真实数据，比较方便；另一方面是提高CPU Cache的命中率，位置靠前的记录真实数据和其对应的长度信息可以更高概率地放在一个Cache Line中。</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>「NULL值列表」是必须的吗？</div><div class="admonitionContent_BuS1"><p>当数据表的字段都定义为 <code>NOT NULL</code> 的时候，行格式中便不会有NULL值列表了。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="行溢出数据处理">行溢出数据处理<a href="#行溢出数据处理" class="hash-link" aria-label="Direct link to 行溢出数据处理" title="Direct link to 行溢出数据处理">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>一行记录的最大长度是65535个字节，那么VARCHAR类型的列最大长度是多少？</div><div class="admonitionContent_BuS1"><p>MySQL 提供VARCHAR类型列最多可以存储<strong>65535个字节</strong>，VARCHAR(n)中的<strong>n指的是字符个数，而非字节个数</strong>。另外因为有一些额外占用，实际并不是65535字节，而是65532字节，并且是指表中<strong>所有VARCHAR列的字节长度总和不超过65535字节</strong>。在计算长度时需要包含变长字段长度列表、NULL标志位信息一起计算，总体不能超过65535个字节！</p></div></div>
<p>当发生行溢出时，会采用溢出页的方式进行存储，当前行保留指向溢出页数据位置的20字节的指针信息。</p>
<p>对于VARCHAR类型的数据，行存储时采用如下策略：行内最多只保存前 <code>prefix_len</code> 个字节的前缀，如果长度溢出则剩下的存储到BLOB页，并在行内保存一个指针。经过测试，当阈值长度为 <code>8098</code> 时，会把 <code>prefix_len=768</code> 的前缀放到行内。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="compressed-和-dynamic-行格式">Compressed 和 Dynamic 行格式<a href="#compressed-和-dynamic-行格式" class="hash-link" aria-label="Direct link to Compressed 和 Dynamic 行格式" title="Direct link to Compressed 和 Dynamic 行格式">​</a></h3>
<p>InnoDB 1.0.x版本引入了Dynamic 和 Compressed 两种新的行记录格式。这两种新的记录格式会把存放到BLOB中的数据采用 <code>prefix_len=0</code> 的策略，也就是只存放20个字节的指针，<strong>数据完全存放到Off Page中</strong>。另外，Compressed 格式会对BLOB、TEXT、VARCHAR类型的列数据使用zlib算法进行压缩。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="char列类型存储方式">CHAR列类型存储方式<a href="#char列类型存储方式" class="hash-link" aria-label="Direct link to CHAR列类型存储方式" title="Direct link to CHAR列类型存储方式">​</a></h3>
<p><code>CHAR(n)</code> 中的n指的是字符个数，对于默认的 <code>latin1</code> 编码，每个字符都  是固定长度的，而对于UTF-8编码，字符长度是变长，<code>CHAR(10)</code> 所占用的字节长度就在10-30之间，所以InnoDB在存储CHAR类型的列时，也把它当做VARCHAR来处理。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="数据页结构">数据页结构<a href="#数据页结构" class="hash-link" aria-label="Direct link to 数据页结构" title="Direct link to 数据页结构">​</a></h2>
<p><img decoding="async" loading="lazy" alt="InnoDB存储引擎数据页结构" src="data:image/png;base64,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" width="557" height="545" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="文件头file-header">文件头（File Header）<a href="#文件头file-header" class="hash-link" aria-label="Direct link to 文件头（File Header）" title="Direct link to 文件头（File Header）">​</a></h3>
<p>文件头用来记录页的一些头信息，共由 8 个部分组成，总共38个字节。</p>
<table><thead><tr><th style="text-align:center">名称</th><th style="text-align:center">大小/字节</th><th>描述</th></tr></thead><tbody><tr><td style="text-align:center">FIL_PAGE_SPACE_OR_CHKSUM</td><td style="text-align:center">4</td><td>MySQL 4.0.14 之前为 0，之后的版本中该值代表页的 checksum</td></tr><tr><td style="text-align:center">FIL_PAGE_OFFSET</td><td style="text-align:center">4</td><td>页号，表空间中页的偏移值，起始值为 0。如果某独立表空间 a.ibd 的大小为 1 GB，如果页的大小为 16 KB，那么总共有 65536 个页。偏移值代表该页在所有页中的位置。同时通过该部分的长度 4 个字节可以算出一个表空间最大支持 2^32 * 16 KB = 64 TB</td></tr><tr><td style="text-align:center">FIL_PAGE_PREV</td><td style="text-align:center">4</td><td>上一页的页号，B+Tree 的特性决定了叶子节点必须是双向列表</td></tr><tr><td style="text-align:center">FIL_PAGE_NEXT</td><td style="text-align:center">4</td><td>下一页的页号，B+Tree 的特性决定了叶子节点必须是双向列表</td></tr><tr><td style="text-align:center">FIL_PAGE_LSN</td><td style="text-align:center">8</td><td>最后被修改的日志序列的 LSN（Log Sequence Number）</td></tr><tr><td style="text-align:center">FIL_PAGE_TYPE</td><td style="text-align:center">2</td><td>页的类型，数据页对应的类型为 FIL_PAGE_INDEX，值为 0x45BF 代表存放的是数据页</td></tr><tr><td style="text-align:center">FIL_PAGE_FILE_FLUSH_LSN</td><td style="text-align:center">8</td><td>仅在系统表空间的一个页中定义，代表 文件成功刷新到磁盘的 LSN。</td></tr><tr><td style="text-align:center">FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID</td><td style="text-align:center">4</td><td>从 MySQL 4.1 开始，该值代表页属于哪个表空间（存放的是表空间 ID）</td></tr></tbody></table>
<p>InnoDB存储引擎中的页的类型</p>
<table><thead><tr><th style="text-align:center">名称</th><th style="text-align:center">大小/字节</th><th>描述</th></tr></thead><tbody><tr><td style="text-align:center">FIL_PAGE_INDEX</td><td style="text-align:center">0x45BF</td><td>B+树叶子节点</td></tr><tr><td style="text-align:center">FIL_PAGE_UNDO_LOG</td><td style="text-align:center">0x0002</td><td>Undo Log页</td></tr><tr><td style="text-align:center">FIL_PAGE_INODE</td><td style="text-align:center">0x0003</td><td>索引节点</td></tr><tr><td style="text-align:center">FIL_PAGE_IBNUF_FREE_LIST</td><td style="text-align:center">0x0004</td><td>Insert Buffer空闲列表</td></tr><tr><td style="text-align:center">FIL_PAGE_TYPE_ALLOCATED</td><td style="text-align:center">0x0000</td><td>该页为最新分配</td></tr><tr><td style="text-align:center">FIL_PAGE_IBUF_BITMAP</td><td style="text-align:center">0x0005</td><td>Insert Buffer 位图</td></tr><tr><td style="text-align:center">FIL_PAGE_TYPE_SYS</td><td style="text-align:center">0x0006</td><td>系统页</td></tr><tr><td style="text-align:center">FIL_PAGE_TYPE_TRX_SYS</td><td style="text-align:center">0x0007</td><td>事务系统数据</td></tr><tr><td style="text-align:center">FIL_PAGE_TYPE_FSP_HDR</td><td style="text-align:center">0x0008</td><td>File Space Header</td></tr><tr><td style="text-align:center">FIL_PAGE_TYPE_XDES</td><td style="text-align:center">0x0009</td><td>扩展描述页</td></tr><tr><td style="text-align:center">FIL_PAGE_TYPE_BLOB</td><td style="text-align:center">0x000A</td><td>BLOB页</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="页头page-header">页头（Page Header）<a href="#页头page-header" class="hash-link" aria-label="Direct link to 页头（Page Header）" title="Direct link to 页头（Page Header）">​</a></h3>
<p>Page Header 用来记录数据页的状态信息，由 14 个部分组成，共占用 56 个字节。</p>
<table><thead><tr><th style="text-align:center">名称</th><th style="text-align:center">大小/字节</th><th>描述</th></tr></thead><tbody><tr><td style="text-align:center">PAGE_N_DIR_SLOTS</td><td style="text-align:center">2</td><td>在 Page Directory 中 Slot 的数量</td></tr><tr><td style="text-align:center">PAGE_HEAP_TOP</td><td style="text-align:center">2</td><td>堆中第一个记录的指针（记录在页中是以堆的形式存放的），该地址之后就是 Free Space</td></tr><tr><td style="text-align:center">PAGE_N_HEAP</td><td style="text-align:center">2</td><td>堆中的记录数（包括最小记录和最大记录以及标记为删除的记录），但是第 15 位表示行记录格式</td></tr><tr><td style="text-align:center">PAGE_FREE</td><td style="text-align:center">2</td><td>指向可重用空间的首指针，即第一个标记为删除的记录的地址（已删除的记录通过 next_record 组成一个链表），如果这个页上有记录要插入，可以先从这里分配空间，如果空间不够，再从 Free Space 分配</td></tr><tr><td style="text-align:center">PAGE_GARBAGE</td><td style="text-align:center">2</td><td>已删除的字节数，即行记录中 delete_mask 为 1 的记录大小的总和</td></tr><tr><td style="text-align:center">PAGE_LAST_INSERT</td><td style="text-align:center">2</td><td>最后插入记录的位置（指向最近一个被插入的记录，主要用来方便后续的插入操作）</td></tr><tr><td style="text-align:center">PAGE_DIRECTION</td><td style="text-align:center">2</td><td>最后一个记录插入的方向。假如新插入的一条记录的主键值比上一条记录的主键值大，那么这条记录的插入方向是从右插入，反之则是从左插入</td></tr><tr><td style="text-align:center">PAGE_N_DIRECTION</td><td style="text-align:center">2</td><td>一个方向连续插入的记录个数，如果最后一条记录的插入方向发生了改变，那么这个该值会被清零重新统计</td></tr><tr><td style="text-align:center">PAGE_N_RECS</td><td style="text-align:center">2</td><td>该页中记录的数量（不包括最小记录和最大记录以及标记为删除的记录）</td></tr><tr><td style="text-align:center">PAGE_MAX_TRX_ID</td><td style="text-align:center">8</td><td>修改当前页的最大事务 ID，该值仅在二级索引中定义</td></tr><tr><td style="text-align:center">PAGE_LEVEL</td><td style="text-align:center">2</td><td>当前页在索引树中的位置，0x00 代表叶子节点，即叶子节点总是在第 0 层</td></tr><tr><td style="text-align:center">PAGE_INDEX_ID</td><td style="text-align:center">8</td><td>索引 ID，表示当前页属于哪个索引</td></tr><tr><td style="text-align:center">PAGE_BTR_SEG_LEAF</td><td style="text-align:center">10</td><td>B+树数据页非叶子节点所在段的 segment header。该值仅在 B+树的 Root 页中定义</td></tr><tr><td style="text-align:center">PAGE_BTR_SEG_TOP</td><td style="text-align:center">10</td><td>B+树数据页所在段的 segment header。该值仅在 B+树的 Root 页中定义</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="infimum-和-supermum-记录">Infimum 和 Supermum 记录<a href="#infimum-和-supermum-记录" class="hash-link" aria-label="Direct link to Infimum 和 Supermum 记录" title="Direct link to Infimum 和 Supermum 记录">​</a></h3>
<p>在 InnoDB 中，每个数据页中都有两个虚拟的行记录，用来限定记录的边界。Infimum 记录比该页中任何记录都要小（对比主键值），而 Supremum 记录则比该页中任何可能大的记录都要大。这两个记录在页创建的时候建立，且在任何情况下都不会被删除。在 Compact 行格式和 Redundant 行格式中，两者占用的字节数不同。</p>
<p>这里需要提到行记录中的 next_record。它表示从当前记录的真实数据到下一条记录的真实数据的地址（即记录头信息和列数据的中间位置）偏移量。比如第一条记录的 next_record 为 32，那么就表示从第一条记录的真实数据的地址处向后找 32 个字节就是下一条记录的真实数据地址。同时需要注意的是，下一条记录并不是按照插入顺序，而是按照主键值由小到大的顺序，Infimum 记录的下一条就是本页中主键值最小的用户记录，而本页中主键值最大的用户记录的下一条就是 Supremum 记录。</p>
<p><img decoding="async" loading="lazy" alt="InnoDB存储引擎Infimum和Supermum示例图" src="/assets/images/innodb_infimum_supermum_example-49c229e6c927317d0113cda9954da81b.png" width="1044" height="549" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="用户记录和空闲空间">用户记录和空闲空间<a href="#用户记录和空闲空间" class="hash-link" aria-label="Direct link to 用户记录和空闲空间" title="Direct link to 用户记录和空闲空间">​</a></h3>
<p>User Records 就是实际存储行记录的部分，Free Space 指的是空闲空间，它是一个链表结构。在一条记录被删除后，该记录的空间会加入到空闲链表中（与其说是加入，不如说是先从可重用链表中分配空间，空间不足再从空闲空间分配）。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="页目录page-directory">页目录（Page Directory）<a href="#页目录page-directory" class="hash-link" aria-label="Direct link to 页目录（Page Directory）" title="Direct link to 页目录（Page Directory）">​</a></h3>
<p>我们知道记录在页中是按照主键值从小到大的顺序组成了一个单链表，如果我们想根据主键值查找页中的某条记录，那么最笨的办法就是从 Infimum 记录开始，沿着链表向后查找（next_record）。这种线性查找的方式在页中存储了很多条记录时性能较差，InnoDB 的设计者们实现了一种更好的查询方式。</p>
<p>他们将页中所有的记录（包括最大和最小记录，但不包括标记为已删除的记录）划分为几个组。每个组的最后一条记录，也就是组内最大的那条记录的头信息中的 n_owned 属性表示组内一共有几条记录。最后将每个组的最后一条记录的地址偏移量（页面从 0 开始数，到该记录时的字节数）单独提取出来按照顺序存储到页目录中，页目录中的这些地址偏移量也被称为槽（Slot）。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/innodb_page_dir_slot1-1c5c92a3ac9840643021eccb3fb44689.png" width="994" height="550" class="img_ev3q"></p>
<p>在这个页目录中有两个槽，0 号槽的值为 99，代表最小记录的地址偏移量，1 号槽的值为 112，代表最大记录的地址偏移量。在最小记录的头信息中，n_owned 的值为 1，表示该分组中只有 1 条记录，也就是最小记录本身。最大记录的头信息中，n_owned 的值为 5，表示该分组中有 5 条记录。</p>
<p>InnoDB 中规定，对于最小记录所在的分组只能有 1 条记录，对于最大记录所在的分组拥有的记录数只能在 1 到 8 条之间，剩下的分组中记录的条数只能在 4 到 8 条之间。即在初始情况下，数据页中只有最小和最大两条记录，它们分为两个组。之后每插入一条记录，都会从页目录中找到主键值比插入记录的主键值大且差值最小的槽（确定该记录应该处于哪个分组中），然后把该槽对应记录的 n_owned 值加 1，直到该组中的记录数等于 8 个。接下来再插入记录时，会将最大记录所在的组拆分成两个，新分离出来的组中有 4 条记录，最大记录所在的组中有 5 条记录。接着上面的例子，我们再插入多条数据。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/innodb_page_dir_slot2-35a1527f070633b601431929b5ef09b7.png" width="1034" height="638" class="img_ev3q"></p>
<p>接下来我们再看一开始提出的问题，在页中查找指定主键值对应的记录。由于各个槽对应的记录的主键值都是按照从小到大的顺序排列的，因此我们可以用二分法进行快速查找。有 0 到 4 共五个槽，初始情况下最小的槽 low = 0，最大的槽 high = 4，假设需要查找的主键值为 6。那么首先计算中间槽的位置：(0 + 4) / 2 = 2，查看 2 号槽中对应的主键值为 8，而 6 又小于 8，所以设置 high = 2，low 保持不变。然后重新计算中间槽的位置为 1，查看槽位对应的主键值为 4，所以设置 low = 1，high 保持不变。由于此时 high 与 low 的差值为 1，所以可以确定主键值为 6 的记录在 2 号槽对应的分组中。此时可以从 1 号槽最大的记录向后查找，该条记录的下一条就是 2 号槽的最小记录，直到找到为止。</p>
<p>所以在一个数据页中查找指定主键值的记录可以分为两个步骤：首先通过二分法确定该记录所在的槽，并找到该槽所在分组中主键值最小的那条记录。接下来就可以通过该记录的 next_record 属性遍历所在分组的各个记录，直到找到为止。同时需要牢记的是，B+树索引本身并不能找到具体的一条记录，能找到的只是该记录所在的页。数据库把页载入内存，然后通过 Page Directory 再进行二叉查找。而在内存进行二分查找是很快的，通常会忽略这部分查找的时间开销。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="文件尾file-tailer">文件尾（File Tailer）<a href="#文件尾file-tailer" class="hash-link" aria-label="Direct link to 文件尾（File Tailer）" title="Direct link to 文件尾（File Tailer）">​</a></h3>
<p>数据在内存中被修改后再同步回磁盘，这个同步的过程相对较慢。如果在同步过程中出现了异常情况，比如机器宕机、断电、磁盘损坏等，数据就有可能会丢失。因此为了检测页的完整性，InnoDB 在页中设置了 File Trailer。文件尾中只有一个 <code>FIL_PAGE_END_LSN</code>，占用 8 个字节。前 4 个字节代表该页的 checksum 值，后 4 个字节与 File Header 中的 <code>FIL_PAGE_LSN</code> 相同。InnoDB 通过将这两个值与 File Header 中的 <code>FIL_PAGE_SPACE_OR_CHKSUM</code> 和 <code>FIL_PAGE_LSN</code> 进行比较（<code>checksum</code> 的比较需要使用 <code>checksum</code> 函数，不是简单的等值比较），看是否一致，以此来保证页的完整性。checksum 操作有一定的开销，可根据 <code>innodb_checksums</code> 参数来控制是否开启，另外可根据 <code>innodb_checksums_algorithm</code> 来选择校验和算法。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="约束">约束<a href="#约束" class="hash-link" aria-label="Direct link to 约束" title="Direct link to 约束">​</a></h2>
<p>InnoDB存储引擎提供了以下几种约束：</p>
<ul>
<li>Primary Key</li>
<li>Unique Key</li>
<li>Foreign Key</li>
<li>Default</li>
<li>NOT NULL</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="视图">视图<a href="#视图" class="hash-link" aria-label="Direct link to 视图" title="Direct link to 视图">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="分区">分区<a href="#分区" class="hash-link" aria-label="Direct link to 分区" title="Direct link to 分区">​</a></h2>
<p>MySQL数据库只支持水平分区，且采用局部分区索引，即一个分区既存放数据又存放索引。</p>
<ul>
<li>水平分区：将同一表中不同行的记录分配到不同的物理文件中。</li>
<li>垂直分区：将同一表中不同列的记录分配到不同的物理文件中。</li>
</ul>
<p>当前MySQL数据库支持以下几种类型的分区：</p>
<ol>
<li>RANGE分区：行数据基于属于一个给定连续区间的列值被放入分区。</li>
<li>LIST分区：和RANGE分区类似，只不过LIST分区面向的是离散的值。</li>
<li>HASH分 区：根据用户自定义的表达式返回值来进行分区，返回值不能为负数。</li>
<li>KEY分区：根据MySQL数据库提供的哈希函数进行分区。</li>
</ol>
<h1>参考资料</h1>
<ul>
<li>《MySQL技术内幕 - InnoDB存储引擎》</li>
<li><a href="https://www.cnblogs.com/xiaolincoding/p/16941244.html" target="_blank" rel="noopener noreferrer">博客 - MySQL 的 NULL 值是怎么存储的？</a></li>
<li><a href="https://juejin.cn/post/7004459098682949645" target="_blank" rel="noopener noreferrer">掘金 - InnoDB引擎-四种行记录存储</a></li>
<li><a href="https://juejin.cn/post/6847902223817506829" target="_blank" rel="noopener noreferrer">掘金 - InnoDB引擎-行记录存储 Redundant行格式</a></li>
<li><a href="https://juejin.cn/post/6844903470860861454" target="_blank" rel="noopener noreferrer">掘金 - InnoDB引擎-行记录存储 Compact行格式</a></li>
<li><a href="https://nekolr.github.io/2020/07/06/InnoDB%20%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84/" target="_blank" rel="noopener noreferrer">nekolr&#x27;s blog - InnoDB 数据页结构</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/database/tags/mysql">mysql</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/database/tags/innodb">innodb</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/database/tags/table">table</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-05-17T03:36:20.000Z" itemprop="dateModified">May 17, 2025</time></b> by <b>vyckey</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/database/mysql/transaction/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Transaction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/database/mysql/innodb/transaction"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transaction</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#逻辑存储结构" class="table-of-contents__link toc-highlight">逻辑存储结构</a></li><li><a href="#行存储方式" class="table-of-contents__link toc-highlight">行存储方式</a><ul><li><a href="#redundant行格式" class="table-of-contents__link toc-highlight">Redundant行格式</a></li><li><a href="#compact行格式" class="table-of-contents__link toc-highlight">Compact行格式</a></li><li><a href="#行溢出数据处理" class="table-of-contents__link toc-highlight">行溢出数据处理</a></li><li><a href="#compressed-和-dynamic-行格式" class="table-of-contents__link toc-highlight">Compressed 和 Dynamic 行格式</a></li><li><a href="#char列类型存储方式" class="table-of-contents__link toc-highlight">CHAR列类型存储方式</a></li></ul></li><li><a href="#数据页结构" class="table-of-contents__link toc-highlight">数据页结构</a><ul><li><a href="#文件头file-header" class="table-of-contents__link toc-highlight">文件头（File Header）</a></li><li><a href="#页头page-header" class="table-of-contents__link toc-highlight">页头（Page Header）</a></li><li><a href="#infimum-和-supermum-记录" class="table-of-contents__link toc-highlight">Infimum 和 Supermum 记录</a></li><li><a href="#用户记录和空闲空间" class="table-of-contents__link toc-highlight">用户记录和空闲空间</a></li><li><a href="#页目录page-directory" class="table-of-contents__link toc-highlight">页目录（Page Directory）</a></li><li><a href="#文件尾file-tailer" class="table-of-contents__link toc-highlight">文件尾（File Tailer）</a></li></ul></li><li><a href="#约束" class="table-of-contents__link toc-highlight">约束</a></li><li><a href="#视图" class="table-of-contents__link toc-highlight">视图</a></li><li><a href="#分区" class="table-of-contents__link toc-highlight">分区</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Notes</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/java">Java</a></li><li class="footer__item"><a class="footer__link-item" href="/ai">AI</a></li></ul></div><div class="col footer__col"><div class="footer__title">E-mail</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:vyckeyolyland@gmail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google E-mail<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:vyckey@qq.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">QQ E-mail<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/vyckey/vyckey-computer-notes" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Vyckey's Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>