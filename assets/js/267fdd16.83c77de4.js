"use strict";(self.webpackChunkvyckey_computer_notes=self.webpackChunkvyckey_computer_notes||[]).push([[2585],{53118:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>o,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var r=s(74848),c=s(28453);const i={title:"EQL",tags:[],sidebar_label:"EQL",sidebar_position:1},l="ES\u67e5\u8be2\u8bed\u6cd5",a={id:"elasticsearch/search",title:"EQL",description:"[toc]",source:"@site/database/elasticsearch/search.md",sourceDirName:"elasticsearch",slug:"/elasticsearch/search",permalink:"/database/elasticsearch/search",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"vyckey",lastUpdatedAt:174745298e4,sidebarPosition:1,frontMatter:{title:"EQL",tags:[],sidebar_label:"EQL",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"ElasticSearch",permalink:"/database/elasticsearch/"},next:{title:"Redis",permalink:"/database/redis/"}},t={},d=[{value:"1.\u57fa\u672c\u67e5\u8be2\u7ed3\u6784",id:"1\u57fa\u672c\u67e5\u8be2\u7ed3\u6784",level:2},{value:"2.\u67e5\u8be2\u5b50\u53e5",id:"2\u67e5\u8be2\u5b50\u53e5",level:2},{value:"2.1 \u5168\u5339\u914d\u67e5\u8be2",id:"21-\u5168\u5339\u914d\u67e5\u8be2",level:3},{value:"match_all \u67e5\u8be2",id:"match_all-\u67e5\u8be2",level:4},{value:"match_none \u67e5\u8be2",id:"match_none-\u67e5\u8be2",level:4},{value:"2.2 \u7ec4\u5408\u67e5\u8be2",id:"22-\u7ec4\u5408\u67e5\u8be2",level:3},{value:"<code>bool</code> \u67e5\u8be2",id:"bool-\u67e5\u8be2",level:4},{value:"<code>boosting</code> \u67e5\u8be2",id:"boosting-\u67e5\u8be2",level:4},{value:"<code>constant_score</code> \u67e5\u8be2",id:"constant_score-\u67e5\u8be2",level:4},{value:"<code>dis_max</code> \u67e5\u8be2",id:"dis_max-\u67e5\u8be2",level:4},{value:"<code>function_score</code> \u8be2\u95ee",id:"function_score-\u8be2\u95ee",level:4},{value:"2.3 Term \u7cbe\u786e\u5339\u914d",id:"23-term-\u7cbe\u786e\u5339\u914d",level:3},{value:"<code>exists</code> \u67e5\u8be2",id:"exists-\u67e5\u8be2",level:4},{value:"<code>fuzzy</code> \u67e5\u8be2",id:"fuzzy-\u67e5\u8be2",level:4},{value:"<code>ids</code> \u67e5\u8be2",id:"ids-\u67e5\u8be2",level:4},{value:"<code>prefix</code> \u67e5\u8be2",id:"prefix-\u67e5\u8be2",level:4},{value:"<code>range</code> \u67e5\u8be2",id:"range-\u67e5\u8be2",level:4},{value:"<code>regexp</code> \u67e5\u8be2",id:"regexp-\u67e5\u8be2",level:4},{value:"<code>term</code> \u67e5\u8be2",id:"term-\u67e5\u8be2",level:4},{value:"<code>terms</code> \u67e5\u8be2",id:"terms-\u67e5\u8be2",level:4},{value:"<code>terms_set</code> \u67e5\u8be2",id:"terms_set-\u67e5\u8be2",level:4},{value:"<code>wildcard</code> \u67e5\u8be2",id:"wildcard-\u67e5\u8be2",level:4},{value:"2.4 \u5168\u6587\u5339\u914d\u67e5\u8be2",id:"24-\u5168\u6587\u5339\u914d\u67e5\u8be2",level:3},{value:"match \u67e5\u8be2",id:"match-\u67e5\u8be2",level:4},{value:"match_bool_prefix \u67e5\u8be2",id:"match_bool_prefix-\u67e5\u8be2",level:4},{value:"match_phrase \u67e5\u8be2",id:"match_phrase-\u67e5\u8be2",level:4},{value:"match_phrase_prefix \u67e5\u8be2",id:"match_phrase_prefix-\u67e5\u8be2",level:4},{value:"multi_match \u67e5\u8be2",id:"multi_match-\u67e5\u8be2",level:4},{value:"combined_fields \u67e5\u8be2",id:"combined_fields-\u67e5\u8be2",level:4},{value:"intervals \u67e5\u8be2",id:"intervals-\u67e5\u8be2",level:4},{value:"query_string \u67e5\u8be2",id:"query_string-\u67e5\u8be2",level:4},{value:"simple_query_string \u67e5\u8be2",id:"simple_query_string-\u67e5\u8be2",level:4},{value:"2.5 \u5730\u5740\u4f4d\u7f6e\u67e5\u8be2",id:"25-\u5730\u5740\u4f4d\u7f6e\u67e5\u8be2",level:3},{value:"2.6 \u5f62\u72b6\u67e5\u8be2",id:"26-\u5f62\u72b6\u67e5\u8be2",level:3},{value:"2.7 Join \u67e5\u8be2",id:"27-join-\u67e5\u8be2",level:3},{value:"2.8 Span \u67e5\u8be2",id:"28-span-\u67e5\u8be2",level:3},{value:"2.9 \u5176\u4ed6\u67e5\u8be2",id:"29-\u5176\u4ed6\u67e5\u8be2",level:3},{value:"3.\u805a\u5408\u5b50\u53e5",id:"3\u805a\u5408\u5b50\u53e5",level:2},{value:"3.1 Metrics \u805a\u5408",id:"31-metrics-\u805a\u5408",level:3},{value:"\u5747\u503c\u3001\u6c42\u548c\u3001\u6700\u5927\u3001\u6700\u5c0f\u3001\u8ba1\u6570\u3001\u52a0\u6743\u5e73\u5747",id:"\u5747\u503c\u6c42\u548c\u6700\u5927\u6700\u5c0f\u8ba1\u6570\u52a0\u6743\u5e73\u5747",level:4},{value:"\u591a\u9879\u7edf\u8ba1",id:"\u591a\u9879\u7edf\u8ba1",level:4},{value:"\u5730\u7406\u4f4d\u7f6e\u805a\u5408",id:"\u5730\u7406\u4f4d\u7f6e\u805a\u5408",level:4},{value:"\u70b9\u548c\u5f62\u72b6\u805a\u5408",id:"\u70b9\u548c\u5f62\u72b6\u805a\u5408",level:4},{value:"Top\u805a\u5408",id:"top\u805a\u5408",level:4},{value:"\u5176\u4ed6\u805a\u5408",id:"\u5176\u4ed6\u805a\u5408",level:4},{value:"3.2 Bucket \u805a\u5408",id:"32-bucket-\u805a\u5408",level:3},{value:"3.3 Pipeline \u805a\u5408",id:"33-pipeline-\u805a\u5408",level:3},{value:"<code>buckets_path</code> \u8bed\u6cd5",id:"buckets_path-\u8bed\u6cd5",level:4},{value:"\u805a\u5408\u6307\u4ee4",id:"\u805a\u5408\u6307\u4ee4",level:4},{value:"4.\u68c0\u7d22API",id:"4\u68c0\u7d22api",level:2},{value:"4.1 \u6392\u5e8f",id:"41-\u6392\u5e8f",level:3},{value:"4.2 \u5206\u9875",id:"42-\u5206\u9875",level:3},{value:"4.3 \u6309\u5b57\u6bb5\u53ec\u56de",id:"43-\u6309\u5b57\u6bb5\u53ec\u56de",level:3},{value:"4.4 \u591a\u4e2a\u6570\u636e\u6d41\u6216\u7d22\u5f15\u9009\u62e9",id:"44-\u591a\u4e2a\u6570\u636e\u6d41\u6216\u7d22\u5f15\u9009\u62e9",level:3},{value:"4.5 \u9ad8\u4eae",id:"45-\u9ad8\u4eae",level:3},{value:"4.6 \u641c\u7d22\u6a21\u677f",id:"46-\u641c\u7d22\u6a21\u677f",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"[toc]"}),"\n",(0,r.jsx)(n.h1,{id:"es\u67e5\u8be2\u8bed\u6cd5",children:"ES\u67e5\u8be2\u8bed\u6cd5"}),"\n",(0,r.jsx)(n.h2,{id:"1\u57fa\u672c\u67e5\u8be2\u7ed3\u6784",children:"1.\u57fa\u672c\u67e5\u8be2\u7ed3\u6784"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /{\u7d22\u5f15\u540d}/_search\n{\n  "_source" :[ ...\u9700\u8981\u8fd4\u56de\u7684\u5b57\u6bb5... ],\n\t"query" : { ...query\u5b50\u53e5... },\n\t"aggs" : { ..aggs\u5b50\u53e5..  },\n\t"sort" : { ..sort\u5b50\u53e5..  },\n  "from" : 0,// \u5206\u9875\u504f\u79fb\u91cf\n  "size" : 10 // \u5206\u9875\u5927\u5c0f\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u68c0\u7d22\u7d22\u5f15\u652f\u6301\u4e00\u5230\u591a\u4e2a\uff0c\u5bf9\u4e8e\u5355\u4e2a\u7d22\u5f15\u91c7\u7528 ",(0,r.jsx)(n.code,{children:"GET /{\u7d22\u5f15\u540d}/_search"})," \u683c\u5f0f\uff0c\u5bf9\u4e8e\u591a\u4e2a\u7d22\u5f15\u53ef\u91c7\u7528\u9017\u53f7\u6216\u901a\u914d\u7b26\u5339\u914d\uff0c\u4f8b\u5982 ",(0,r.jsx)(n.code,{children:"GET /order1,order2/_search"})," \u6216 ",(0,r.jsx)(n.code,{children:"GET /order*/_search"})," \u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884c\u67e5\u8be2\u8bed\u53e5\uff0c\u8fd4\u56de\u7684\u6837\u4f8bJSON\u6570\u636e\u683c\u5f0f\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'{\n  "took" : 12, // \u67e5\u8be2\u6d88\u8017\u65f6\u95f4\uff0c\u5355\u4f4d\u6beb\u79d2 \n  "timed_out" : false, // \u67e5\u8be2\u662f\u5426\u8d85\u65f6\n  "_shards" : { // \u672c\u6b21\u67e5\u8be2\u53c2\u4e0e\u7684ES\u5206\u7247\u4fe1\u606f\uff0c\u67e5\u8be2\u4e2d\u53c2\u4e0e\u5206\u7247\u7684\u603b\u6570\uff0c\u4ee5\u53ca\u8fd9\u4e9b\u5206\u7247\u6210\u529f\u4e86\u591a\u5c11\u4e2a\u5931\u8d25\u4e86\u591a\u5c11\u4e2a\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : { // hits\u5b57\u6bb5\u5305\u542b\u6211\u4eec\u641c\u7d22\u5339\u914d\u7684\u7ed3\u679c\n    "total" : { // \u5339\u914d\u5230\u7684\u6587\u6863\u603b\u6570\n      "value" : 15, // \u627e\u523015\u4e2a\u6587\u6863\n      "relation" : "eq"\n    },\n    "max_score" : 1.0, // \u5339\u914d\u5230\u7684\u6700\u5927\u5206\u503c\n    "hits" : [ \n        {...}, // \u8fd9\u91cc\u5c31\u662f\u6211\u4eec\u5177\u4f53\u7684\u641c\u7d22\u7ed3\u679c\uff0c\u662f\u4e00\u4e2aJSON\u6587\u6863\u6570\u7ec4\n        {...}\n    ]\n  },\n  "aggregations": {\n    ...\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"2\u67e5\u8be2\u5b50\u53e5",children:"2.\u67e5\u8be2\u5b50\u53e5"}),"\n",(0,r.jsx)(n.p,{children:"query\u5b50\u53e5\u4e3b\u8981\u7528\u6765\u7f16\u5199\u7c7b\u4f3cSQL\u7684Where\u8bed\u53e5\uff0c\u652f\u6301\u5e03\u5c14\u67e5\u8be2\uff08and/or\uff09\u3001IN\u3001\u5168\u6587\u641c\u7d22\u3001\u6a21\u7cca\u5339\u914d\u3001\u8303\u56f4\u67e5\u8be2\uff08\u5927\u4e8e\u5c0f\u4e8e\uff09\u3002"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"query"})," \u548c ",(0,r.jsx)(n.code,{children:"filter"})," \u7684\u533a\u522b\u70b9\u5728\u4e8e ",(0,r.jsx)(n.code,{children:"filter"})," \u4ec5\u505a\u6761\u4ef6\u8fc7\u6ee4\uff0c\u800c ",(0,r.jsx)(n.code,{children:"query"})," \u4f1a\u989d\u5916\u8ba1\u7b97\u6587\u6863\u7684\u76f8\u5173\u6027\uff0c\u5373\u6253\u5206 ",(0,r.jsx)(n.code,{children:"_score"})," \u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"21-\u5168\u5339\u914d\u67e5\u8be2",children:"2.1 \u5168\u5339\u914d\u67e5\u8be2"}),"\n",(0,r.jsx)(n.h4,{id:"match_all-\u67e5\u8be2",children:"match_all \u67e5\u8be2"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b98\u65b9\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-all-query.html",children:"Match all query"})]}),"\n",(0,r.jsx)(n.p,{children:"\u5339\u914d\u6240\u6709\u6587\u6863\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n    "query": {\n        "match_all": {}\n    }\n}\n\nGET /_search\n{\n  "query": {\n    "match_all": { "boost" : 1.2 }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"match_none-\u67e5\u8be2",children:"match_none \u67e5\u8be2"}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0e ",(0,r.jsx)(n.code,{children:"match_all"})," \u67e5\u8be2\u76f8\u5173\uff0c\u4e0d\u5339\u914d\u4efb\u4f55\u6587\u6863\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "match_none": {}\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"22-\u7ec4\u5408\u67e5\u8be2",children:"2.2 \u7ec4\u5408\u67e5\u8be2"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b98\u7f51\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/compound-queries.html",children:"Compound queries"})]}),"\n",(0,r.jsx)(n.p,{children:"\u590d\u5408\u67e5\u8be2\u5305\u88c5\u5176\u4ed6\u590d\u5408\u67e5\u8be2\u6216\u53f6\u67e5\u8be2\uff0c\u4ee5\u7ec4\u5408\u5b83\u4eec\u7684\u7ed3\u679c\u548c\u5206\u6570\uff0c\u6539\u53d8\u5b83\u4eec\u7684\u884c\u4e3a\uff0c\u6216\u8005\u4ece\u67e5\u8be2\u5207\u6362\u5230\u8fc7\u6ee4\u4e0a\u4e0b\u6587\u3002"}),"\n",(0,r.jsxs)(n.h4,{id:"bool-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"bool"})," \u67e5\u8be2"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"bool"})," \u67e5\u8be2\u7528\u4e8e\u7ec4\u5408\u591a\u4e2a\u53f6\u6216\u590d\u5408\u67e5\u8be2\u5b50\u53e5\uff08",(0,r.jsx)(n.code,{children:"must"})," \u3001",(0,r.jsx)(n.code,{children:"should"})," \u3001",(0,r.jsx)(n.code,{children:"must_not"})," \u3001",(0,r.jsx)(n.code,{children:"filter"}),"\uff09\u8fdb\u884c\u8fc7\u6ee4\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f ",(0,r.jsx)(n.code,{children:"must"})," \u3001",(0,r.jsx)(n.code,{children:"should"})," \u3001",(0,r.jsx)(n.code,{children:"must_not"})," \u7b49\u540c\u4e8e\u903b\u8f91\u64cd\u4f5c ",(0,r.jsx)(n.code,{children:"and"})," \u3001",(0,r.jsx)(n.code,{children:"or"})," \u3001",(0,r.jsx)(n.code,{children:"not"})," \u3002\u5176\u4e2d ",(0,r.jsx)(n.code,{children:"must"})," \u3001",(0,r.jsx)(n.code,{children:"should"})," \u4f1a\u5bf9\u6253\u5206\u8d21\u732e\uff0c\u800c ",(0,r.jsx)(n.code,{children:"must_not"})," \u3001",(0,r.jsx)(n.code,{children:"filter"})," \u4ec5\u7528\u4e8e\u8fc7\u6ee4\uff0c\u4e0d\u5bf9\u6253\u5206\u6709\u5f71\u54cd\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "bool" : {\n      "must" : {\n        "term" : { "user.id" : "kimchy" }\n      },\n      "filter": {\n        "term" : { "tags" : "production" }\n      },\n      "must_not" : {\n        "range" : {\n          "age" : { "gte" : 10, "lte" : 20 }\n        }\n      },\n      "should" : [\n        { "term" : { "tags" : "env1" } },\n        { "term" : { "tags" : "deployed" } }\n      ],\n      "minimum_should_match" : 1,\n      "boost" : 1.0\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"boosting-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"boosting"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u6709\u5339\u914d\u5185\u5bb9\u5bf9\u7ed3\u679c\u6709\u6b63\u5411\uff08positive\uff09\u7684\u6253\u5206\u8d21\u732e\uff0c\u5426\u5219\u4f1a\u6709\u8d1f\u5411\uff08negtive\uff09\u7684\u8d21\u732e\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "boosting": {\n      "positive": {\n        "term": {\n          "text": "apple"\n        }\n      },\n      "negative": {\n        "term": {\n          "text": "pie tart fruit crumble tree"\n        }\n      },\n      "negative_boost": 0.5\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"constant_score-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"constant_score"})," \u67e5\u8be2"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u53e6\u4e00\u4e2a\u67e5\u8be2\u7684\u8fdb\u884c\u5305\u88c5\uff0c\u4f46\u4ec5\u5728\u8fc7\u6ee4\u5668\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u3002\u6240\u6709\u5339\u914d\u7684\u6587\u6863\u90fd\u88ab\u8d4b\u4e88\u76f8\u540c\u7684\u201c\u5e38\u91cf\u201d ",(0,r.jsx)(n.code,{children:"_score"})," \u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": { "user.id": "kimchy" }\n      },\n      "boost": 1.2\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"dis_max-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"dis_max"})," \u67e5\u8be2"]}),"\n",(0,r.jsxs)(n.p,{children:["\u63a5\u53d7\u591a\u4e2a\u67e5\u8be2\u5e76\u8fd4\u56de\u4e0e\u4efb\u4f55\u67e5\u8be2\u5b50\u53e5\u5339\u914d\u7684\u4efb\u4f55\u6587\u6863\u7684\u67e5\u8be2\u3002\u867d\u7136 ",(0,r.jsx)(n.code,{children:"bool"})," \u67e5\u8be2\u7ec4\u5408\u4e86\u6240\u6709\u5339\u914d\u67e5\u8be2\u7684\u5206\u6570\uff0c\u4f46 ",(0,r.jsx)(n.code,{children:"dis_max"})," \u67e5\u8be2\u4f7f\u7528\u5355\u4e2a\u6700\u4f73\u5339\u914d\u67e5\u8be2\u5b50\u53e5\u7684\u5206\u6570\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "dis_max": {\n      "queries": [\n        { "term": { "title": "Quick pets" } },\n        { "term": { "body": "Quick pets" } }\n      ],\n      "tie_breaker": 0.7\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"function_score-\u8be2\u95ee",children:[(0,r.jsx)(n.code,{children:"function_score"})," \u8be2\u95ee"]}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528\u51fd\u6570\u81ea\u5b9a\u4e49\u4e3b\u67e5\u8be2\u8fd4\u56de\u7684\u5206\u6570\uff0c\u4f8b\u5982\u8003\u8651\u6d41\u884c\u5ea6\u3001\u6700\u8fd1\u7a0b\u5ea6\u3001\u8ddd\u79bb\u6216\u901a\u8fc7\u811a\u672c\u5b9e\u73b0\u7684\u81ea\u5b9a\u4e49\u7b97\u6cd5\u7b49\u56e0\u7d20\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "function_score": {\n      "query": { "match_all": {} },\n      "boost": "5", \n      "functions": [\n        {\n          "filter": { "match": { "test": "bar" } },\n          "random_score": {}, \n          "weight": 23\n        },\n        {\n          "filter": { "match": { "test": "cat" } },\n          "weight": 42\n        }\n      ],\n      "max_boost": 42,\n      "score_mode": "max",\n      "boost_mode": "multiply",\n      "min_score": 42\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"23-term-\u7cbe\u786e\u5339\u914d",children:"2.3 Term \u7cbe\u786e\u5339\u914d"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b98\u65b9\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/term-level-queries.html",children:"Term-level queries"})]}),"\n",(0,r.jsxs)(n.h4,{id:"exists-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"exists"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u5305\u542b\u5b57\u6bb5\u7684\u4efb\u4f55\u7d22\u5f15\u503c\u7684\u6587\u6863\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "bool": {\n      "must_not": {\n        "exists": {\n          "field": "user.id"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"fuzzy-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"fuzzy"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u5305\u542b\u4e0e\u641c\u7d22\u8bcd\u7c7b\u4f3c\u7684\u8bcd\u7684\u6587\u6863\u3002Elasticsearch \u4f7f\u7528Levenshtein \u7f16\u8f91\u8ddd\u79bb\u6765\u6d4b\u91cf\u76f8\u4f3c\u6027\u6216\u6a21\u7cca\u6027\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "fuzzy": {\n      "user.id": {\n        "value": "ki", // \u5fc5\u586b\uff0c\u4f60\u5e0c\u671b\u627e\u7684\u503c\n        "fuzziness": "AUTO", // \u5141\u8bb8\u5339\u914d\u7684\u6700\u5927\u7f16\u8f91\u8ddd\u79bb\n        "max_expansions": 50,// \u5141\u8bb8\u521b\u5efa\u7684\u6700\u5927\u53d8\u4f53\u4e2a\u6570\uff0c\u9ed8\u8ba450\n        "prefix_length": 0,// \u5b57\u7b26\u524d\u7f00\u957f\u5ea6\uff0c\u9ed8\u8ba40\n        "transpositions": true,// \u662f\u5426\u5141\u8bb8\u4e24\u4e2a\u4e34\u8fd1\u5b57\u7b26\u53d8\u6362\u4f4d\u7f6e\uff08ab\u2192ba\uff09\n        "rewrite": "constant_score_blended"// \u91cd\u5199query\u7684\u65b9\u6cd5\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"ids-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"ids"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u6839\u636e\u6587\u6863 ID \u8fd4\u56de\u6587\u6863\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "ids" : {\n      "values" : ["1", "4", "100"]\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"prefix-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"prefix"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u5728\u63d0\u4f9b\u7684\u5b57\u6bb5\u4e2d\u5305\u542b\u7279\u5b9a\u524d\u7f00\u7684\u6587\u6863\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "prefix": {\n      "user.id": {\n        "value": "ki"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"range-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"range"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u5305\u542b\u7ed9\u5b9a\u8303\u56f4\u5185\u7684\u672f\u8bed\u7684\u6587\u6863\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "range": {\n      "age": {\n        "gte": 10,\n        "lte": 20,\n        "boost": 2.0\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"regexp-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"regexp"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u5305\u542b\u4e0e \u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u7684\u672f\u8bed\u7684\u6587\u6863\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "regexp": {\n      "user.id": {\n        "value": "k.*y",\n        "flags": "ALL",\n        "case_insensitive": true,\n        "max_determinized_states": 10000,\n        "rewrite": "constant_score_blended"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"term-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"term"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u5728\u63d0\u4f9b\u7684\u5b57\u6bb5\u4e2d\u5305\u542b\u786e\u5207\u672f\u8bed\u7684\u6587\u6863\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "term": {\n      "user.id": {\n        "value": "kimchy",\n        "boost": 1.0\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"terms-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"terms"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u5728\u6240\u63d0\u4f9b\u7684\u5b57\u6bb5\u4e2d\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u7cbe\u786e\u672f\u8bed\u7684\u6587\u6863\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "terms": {\n      "user.id": [ "kimchy", "elkbee" ],\n      "boost": 1.0\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"terms_set-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"terms_set"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u5728\u63d0\u4f9b\u7684\u5b57\u6bb5\u4e2d\u5305\u542b\u6700\u5c11\u6570\u91cf\u7684\u7cbe\u786e\u672f\u8bed\u7684\u6587\u6863\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b57\u6bb5\u6216\u811a\u672c\u5b9a\u4e49\u5339\u914d\u672f\u8bed\u7684\u6700\u5c0f\u6570\u91cf\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /job-candidates/_search\n{\n  "query": {\n    "terms_set": {\n      "programming_languages": {\n        "terms": [ "c++", "java", "php" ],\n        "minimum_should_match_field": "required_matches"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"wildcard-\u67e5\u8be2",children:[(0,r.jsx)(n.code,{children:"wildcard"})," \u67e5\u8be2"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u5305\u542b\u4e0e\u901a\u914d\u7b26\u6a21\u5f0f\u5339\u914d\u7684\u672f\u8bed\u7684\u6587\u6863\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "wildcard": {\n      "user.id": {\n        "value": "ki*y",\n        "boost": 1.0,\n        "rewrite": "constant_score_blended"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"24-\u5168\u6587\u5339\u914d\u67e5\u8be2",children:"2.4 \u5168\u6587\u5339\u914d\u67e5\u8be2"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b98\u65b9\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/full-text-queries.html",children:"Full text queries"})]}),"\n",(0,r.jsx)(n.p,{children:"\u5168\u6587\u67e5\u8be2\u4f7f\u60a8\u80fd\u591f\u641c\u7d22\u5206\u6790\u7684\u6587\u672c\u5b57\u6bb5\uff0c\u4f8b\u5982\u7535\u5b50\u90ae\u4ef6\u6b63\u6587\u3002\u4f7f\u7528\u5728\u7d22\u5f15\u671f\u95f4\u5e94\u7528\u4e8e\u5b57\u6bb5\u7684\u540c\u4e00\u5206\u6790\u5668\u6765\u5904\u7406\u67e5\u8be2\u5b57\u7b26\u4e32\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"match-\u67e5\u8be2",children:"match \u67e5\u8be2"}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u4e8e\u6267\u884c\u5168\u6587\u67e5\u8be2\u7684\u6807\u51c6\u67e5\u8be2\uff0c\u5305\u62ec\u6a21\u7cca\u5339\u914d\u548c\u77ed\u8bed\u6216\u90bb\u8fd1\u67e5\u8be2\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "match": {\n      "message": {\n        "query": "this is a test"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"match_bool_prefix-\u67e5\u8be2",children:"match_bool_prefix \u67e5\u8be2"}),"\n",(0,r.jsx)(n.p,{children:"\u521b\u5efa\u4e00\u4e2abool\u67e5\u8be2\uff0c\u5c06\u6bcf\u4e2a\u672f\u8bed\u4f5c\u4e3aterm\u67e5\u8be2\u8fdb\u884c\u5339\u914d\uff0c\u6700\u540e\u4e00\u4e2a\u672f\u8bed\u9664\u5916\uff0c\u5b83\u4f5c\u4e3aprefix\u67e5\u8be2 \u8fdb\u884c\u5339\u914d\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "match_bool_prefix" : {\n      "message" : "quick brown f"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"match_phrase-\u67e5\u8be2",children:"match_phrase \u67e5\u8be2"}),"\n",(0,r.jsx)(n.p,{children:"\u7c7b\u4f3c\u4e8ematch\u67e5\u8be2\uff0c\u4f46\u7528\u4e8e\u5339\u914d\u7cbe\u786e\u7684\u77ed\u8bed\u6216\u5355\u8bcd\u90bb\u8fd1\u5339\u914d\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "match_phrase": {\n      "message": "this is a test"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"match_phrase_prefix-\u67e5\u8be2",children:"match_phrase_prefix \u67e5\u8be2"}),"\n",(0,r.jsx)(n.p,{children:"\u4e0e\u67e5\u8be2\u7c7b\u4f3cmatch_phrase\uff0c\u4f46\u5bf9\u6700\u7ec8\u5355\u8bcd\u8fdb\u884c\u901a\u914d\u7b26\u641c\u7d22\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "match_phrase_prefix": {\n      "message": {\n        "query": "quick brown f"\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"multi_match-\u67e5\u8be2",children:"multi_match \u67e5\u8be2"}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u8be2\u7684\u591a\u5b57\u6bb5\u7248\u672cmatch\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "multi_match" : {\n      "query":    "this is a test", \n      "fields": [ "subject", "message" ] \n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"combined_fields-\u67e5\u8be2",children:"combined_fields \u67e5\u8be2"}),"\n",(0,r.jsx)(n.p,{children:"\u5339\u914d\u591a\u4e2a\u5b57\u6bb5\uff0c\u5c31\u50cf\u5b83\u4eec\u5df2\u88ab\u7d22\u5f15\u5230\u4e00\u4e2a\u7ec4\u5408\u5b57\u6bb5\u4e2d\u4e00\u6837\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "combined_fields" : {\n      "query":      "database systems",\n      "fields":     [ "title", "abstract", "body"],\n      "operator":   "and"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"intervals-\u67e5\u8be2",children:"intervals \u67e5\u8be2"}),"\n",(0,r.jsx)(n.p,{children:"\u5168\u6587\u67e5\u8be2\uff0c\u5141\u8bb8\u5bf9\u5339\u914d\u672f\u8bed\u7684\u987a\u5e8f\u548c\u63a5\u8fd1\u5ea6\u8fdb\u884c\u7ec6\u7c92\u5ea6\u63a7\u5236\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0b\u9762\u7684 ",(0,r.jsx)(n.code,{children:"intervals"})," \u68c0\u7d22\u8fd4\u56de\u6587\u6863 ",(0,r.jsx)(n.code,{children:"my_text"})," \u5b57\u6bb5\u4e2d\u5305\u542b ",(0,r.jsx)(n.code,{children:"my favorite food"})," \u6ca1\u6709\u4efb\u4f55\u7684gap, \u63a5\u7740\u662f ",(0,r.jsx)(n.code,{children:"hot water"})," or ",(0,r.jsx)(n.code,{children:"cold porridge"})," \u3002\u8fd9\u4e2a\u68c0\u7d22\u5c06\u5339\u914d ",(0,r.jsx)(n.code,{children:"my_text"})," \u5b57\u6bb5\u503c ",(0,r.jsx)(n.code,{children:"my favorite food is cold porridge"})," \u4f46\u662f\u4e0d\u4f1a\u5339\u914d ",(0,r.jsx)(n.code,{children:"when it's cold my favorite food is porridge"})," \u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "intervals" : {\n      "my_text" : {\n        "all_of" : {\n          "ordered" : true,\n          "intervals" : [\n            {\n              "match" : {\n                "query" : "my favorite food",\n                "max_gaps" : 0,\n                "ordered" : true\n              }\n            },\n            {\n              "any_of" : {\n                "intervals" : [\n                  { "match" : { "query" : "hot water" } },\n                  { "match" : { "query" : "cold porridge" } }\n                ]\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"query_string-\u67e5\u8be2",children:"query_string \u67e5\u8be2"}),"\n",(0,r.jsxs)(n.p,{children:["\u652f\u6301\u7d27\u51d1\u7684 Lucene\u67e5\u8be2\u5b57\u7b26\u4e32\u8bed\u6cd5\uff0c\u5141\u8bb8\u60a8\u5728\u5355\u4e2a\u67e5\u8be2\u5b57\u7b26\u4e32\u4e2d\u6307\u5b9a ",(0,r.jsx)(n.code,{children:"AND|OR|NOT"})," \u6761\u4ef6\u548c\u591a\u5b57\u6bb5\u641c\u7d22\u3002\u4ec5\u4f9b\u4e13\u5bb6\u7528\u6237\u4f7f\u7528\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "query_string": {\n      "query": "(new york city) OR (big apple)",\n      "default_field": "content"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"simple_query_string-\u67e5\u8be2",children:"simple_query_string \u67e5\u8be2"}),"\n",(0,r.jsx)(n.p,{children:"\u66f4\u7b80\u5355\u3001\u66f4\u5065\u58ee\u7684\u8bed\u6cd5\u7248\u672cquery_string\uff0c\u9002\u5408\u76f4\u63a5\u5411\u7528\u6237\u516c\u5f00\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "query": {\n    "simple_query_string" : {\n        "query": "\\"fried eggs\\" +(eggplant | potato) -frittata",\n        "fields": ["title^5", "body"],\n        "default_operator": "and"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"25-\u5730\u5740\u4f4d\u7f6e\u67e5\u8be2",children:"2.5 \u5730\u5740\u4f4d\u7f6e\u67e5\u8be2"}),"\n",(0,r.jsxs)(n.p,{children:["\u53c2\u8003\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-queries.html",children:"Geo queries"})]}),"\n",(0,r.jsx)(n.h3,{id:"26-\u5f62\u72b6\u67e5\u8be2",children:"2.6 \u5f62\u72b6\u67e5\u8be2"}),"\n",(0,r.jsxs)(n.p,{children:["\u53c2\u8003\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/shape-queries.html",children:"Shape queries"})]}),"\n",(0,r.jsx)(n.h3,{id:"27-join-\u67e5\u8be2",children:"2.7 Join \u67e5\u8be2"}),"\n",(0,r.jsxs)(n.p,{children:["\u53c2\u8003\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/joining-queries.html",children:"Joining queries"})]}),"\n",(0,r.jsx)(n.h3,{id:"28-span-\u67e5\u8be2",children:"2.8 Span \u67e5\u8be2"}),"\n",(0,r.jsxs)(n.p,{children:["\u53c2\u8003\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/span-queries.html",children:"Span queries"})]}),"\n",(0,r.jsx)(n.h3,{id:"29-\u5176\u4ed6\u67e5\u8be2",children:"2.9 \u5176\u4ed6\u67e5\u8be2"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/regexp-syntax.html",children:"Regular expression syntax"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u7279\u6b8a\u67e5\u8be2\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/specialized-queries.html",children:"Specialized queries"})]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-minimum-should-match.html",children:"minimum_should_match \u53c2\u6570"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-term-rewrite.html",children:"rewrite \u53c2\u6570"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3\u805a\u5408\u5b50\u53e5",children:"3.\u805a\u5408\u5b50\u53e5"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b98\u65b9\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html",children:"Aggregations"})]}),"\n",(0,r.jsx)(n.p,{children:"Elasticsearch \u5c06\u805a\u5408\u5206\u4e3a\u4e09\u7c7b\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Metric\uff1a\u6839\u636e\u5b57\u6bb5\u503c\u8ba1\u7b97\u6307\u6807\uff08\u4f8b\u5982\u603b\u548c\u6216\u5e73\u5747\u503c\uff09\u7684\u6307\u6807\u805a\u5408\u3002"}),"\n",(0,r.jsx)(n.li,{children:"Bucket\uff1a\u5b58\u50a8\u6876\u805a\u5408\uff0c\u6839\u636e\u5b57\u6bb5\u503c\u3001\u8303\u56f4\u6216\u5176\u4ed6\u6761\u4ef6\u5c06\u6587\u6863\u5206\u7ec4\u5230\u5b58\u50a8\u6876\uff08\u4e5f\u79f0\u4e3a\u5b58\u50a8\u6876\uff09\u4e2d\u3002"}),"\n",(0,r.jsx)(n.li,{children:"Pipeline\uff1a\u7ba1\u9053\u805a\u5408\u4ece\u5176\u4ed6\u805a\u5408\u800c\u4e0d\u662f\u6587\u6863\u6216\u5b57\u6bb5\u83b7\u53d6\u8f93\u5165\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"31-metrics-\u805a\u5408",children:"3.1 Metrics \u805a\u5408"}),"\n",(0,r.jsx)(n.h4,{id:"\u5747\u503c\u6c42\u548c\u6700\u5927\u6700\u5c0f\u8ba1\u6570\u52a0\u6743\u5e73\u5747",children:"\u5747\u503c\u3001\u6c42\u548c\u3001\u6700\u5927\u3001\u6700\u5c0f\u3001\u8ba1\u6570\u3001\u52a0\u6743\u5e73\u5747"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-avg-aggregation.html",children:"avg"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-sum-aggregation.html",children:"sum"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-min-aggregation.html",children:"min"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-max-aggregation.html",children:"max"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-valuecount-aggregation.html",children:"value_count"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-weight-avg-aggregation.html",children:"Weighted avg"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6837\u4f8b\u8f93\u5165\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'POST /exams/_search?size=0\n{\n  "aggs": {\n    "avg_grade": { "avg": { "field": "grade" } },\n    "max_price": { "max": { "field": "price" } },\n    "weighted_grade": {\n      "weighted_avg": {\n        "value": {\n          "field": "grade"\n        },\n        "weight": {\n          "field": "weight"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u8f93\u51fa\u7ed3\u679c\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'{\n  ...\n  "aggregations": {\n    "avg_grade": {\n        "value": 75.0\n    },\n    "max_price": {\n        "value": 200.0\n    },\n    "weighted_grade": {\n      "value": 70.0\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u591a\u9879\u7edf\u8ba1",children:"\u591a\u9879\u7edf\u8ba1"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-stats-aggregation.html",children:"stats"}),"\uff1a\u4f1a\u8fd4\u56de ",(0,r.jsx)(n.code,{children:"min"}),", ",(0,r.jsx)(n.code,{children:"max"}),", ",(0,r.jsx)(n.code,{children:"sum"}),", ",(0,r.jsx)(n.code,{children:"count"}),", ",(0,r.jsx)(n.code,{children:"avg"})," \u591a\u9879\u805a\u5408\u6307\u6807\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-extendedstats-aggregation.html",children:"extended_stats"}),"\uff1a ",(0,r.jsx)(n.code,{children:"stats"})," \u7684\u6269\u5c55\uff0c\u4f1a\u989d\u5916\u5730\u5305\u542b ",(0,r.jsx)(n.code,{children:"sum_of_squares"}),", ",(0,r.jsx)(n.code,{children:"variance"}),", ",(0,r.jsx)(n.code,{children:"std_deviation"})," and ",(0,r.jsx)(n.code,{children:"std_deviation_bounds"})," \u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-matrix-stats-aggregation.html",children:"matrix_stats"}),"\uff1a\u8ba1\u7b97\u6307\u6807\u5305\u542b\uff1a ",(0,r.jsx)(n.code,{children:"count"}),", ",(0,r.jsx)(n.code,{children:"mean"}),", ",(0,r.jsx)(n.code,{children:"variance"}),", ",(0,r.jsx)(n.code,{children:"skewness"}),", ",(0,r.jsx)(n.code,{children:"kurtosits"}),", ",(0,r.jsx)(n.code,{children:"covariance"}),", ",(0,r.jsx)(n.code,{children:"correlation"})," \u591a\u9879\u805a\u5408\u6307\u6807\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-boxplot-aggregation.html",children:"boxplot"}),"\uff1a\u8fd4\u56de\u4e00\u4e9b\u91cd\u8981\u7684\u4fe1\u606f\uff1a ",(0,r.jsx)(n.code,{children:"min"}),", ",(0,r.jsx)(n.code,{children:"max"}),", ",(0,r.jsx)(n.code,{children:"median"}),", ",(0,r.jsx)(n.code,{children:"25th percentile"}),", ",(0,r.jsx)(n.code,{children:"75th percentile"})," \u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-cardinality-aggregation.html",children:"type_count"}),"\uff1a\u7b49\u540c\u4e8eSQL\u4e2d\u7684 ",(0,r.jsx)(n.code,{children:"count(distinct field)"})," \u64cd\u4f5c\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-median-absolute-deviation-aggregation.html",children:"median_absolute_deviation"}),"\uff1a\u4e2d\u4f4d\u7edd\u5bf9\u504f\u5dee\u805a\u5408\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-percentile-aggregation.html",children:"percentiles"}),"\uff1a\u767e\u5206\u6570\u805a\u5408\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-percentile-rank-aggregation.html",children:"percentile_ranks"}),"\uff1a\u767e\u5206\u4f4d\u6570\u6392\u540d\u805a\u5408\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-string-stats-aggregation.html",children:"string_stats"}),"\uff1a",(0,r.jsx)(n.code,{children:"multi-value"})," \u7528\u4e8e\u8ba1\u7b97\u4ece\u805a\u5408\u6587\u6863\u4e2d\u63d0\u53d6\u7684\u5b57\u7b26\u4e32\u503c\u7684\u7edf\u8ba1\u4fe1\u606f\uff1a ",(0,r.jsx)(n.code,{children:"count"}),", ",(0,r.jsx)(n.code,{children:"min_length"}),", ",(0,r.jsx)(n.code,{children:"max_length"}),", ",(0,r.jsx)(n.code,{children:"avg_length"}),", ",(0,r.jsx)(n.code,{children:"entropy"})," \u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'POST /exams/_search?size=0\n{\n  "aggs": {\n    "grades_stats": { "stats": { "field": "grade" } }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'{\n  ...\n\n  "aggregations": {\n    "grades_stats": {\n      "count": 2,\n      "min": 50.0,\n      "max": 100.0,\n      "avg": 75.0,\n      "sum": 150.0\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u5730\u7406\u4f4d\u7f6e\u805a\u5408",children:"\u5730\u7406\u4f4d\u7f6e\u805a\u5408"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/*search-aggregations-metrics-geobounds-aggregation.html",children:"geo_bounds"}),"\uff1a\u5730\u7406\u4f4d\u7f6e\u8fb9\u754c\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-geocentroid-aggregation.html",children:"geo_centroid"}),"\uff1a\u5730\u5740\u4f4d\u7f6e\u4e2d\u95f4\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-geo-line.html",children:"geo_line"}),"\uff1a\u5730\u5740\u4f4d\u7f6e\u8fde\u7ebf\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u70b9\u548c\u5f62\u72b6\u805a\u5408",children:"\u70b9\u548c\u5f62\u72b6\u805a\u5408"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-cartesian-bounds-aggregation.html",children:"cartesian_bounds"}),"\uff1a\u7b1b\u5361\u5c14\u8fb9\u754c\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-cartesian-centroid-aggregation.html",children:"cartesian_centroid"}),"\uff1a\u7b1b\u5361\u5c14\u4e2d\u5fc3\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"top\u805a\u5408",children:"Top\u805a\u5408"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-top-hits-aggregation.html",children:"top_hits"}),"\uff1atop_hits \u5ea6\u91cf\u805a\u5408\u5668\u8ddf\u8e2a\u6b63\u5728\u805a\u5408\u7684\u6700\u76f8\u5173\u7684\u6587\u6863\u3002\u8be5\u805a\u5408\u5668\u65e8\u5728\u7528\u4f5c\u5b50\u805a\u5408\u5668\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u805a\u5408\u6bcf\u4e2a\u5b58\u50a8\u6876\u7684\u9876\u90e8\u5339\u914d\u6587\u6863\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-top-metrics.html",children:"top_metrics"}),"\uff1atop_metrics \u805a\u5408\u4ece\u5177\u6709\u6700\u5927\u6216\u6700\u5c0f\u201c\u6392\u5e8f\u201d\u503c\u7684\u6587\u6863\u4e2d\u9009\u62e9\u6307\u6807\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u5176\u4ed6\u805a\u5408",children:"\u5176\u4ed6\u805a\u5408"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-rate-aggregation.html",children:"rate"}),"\uff1a\u6307\u6807\u805a\u5408\u53ea\u80fd\u5728 ",(0,r.jsx)(n.code,{children:"date_histogram"})," \u6216 ",(0,r.jsx)(n.code,{children:"composite"})," \u805a\u5408\u5185\u90e8\u4f7f\u7528\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-scripted-metric-aggregation.html",children:"scripted_metric"}),"\uff1a\u4f7f\u7528\u811a\u672c\u8fdb\u884c\u805a\u5408\u8fd0\u7b97\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-ttest-aggregation.html",children:"t_test"}),"\uff1a\u6267\u884c\u7edf\u8ba1\u5047\u8bbe\u68c0\u9a8c\u7684 t_test \u6307\u6807\u805a\u5408\uff0c\u5176\u4e2d\u68c0\u9a8c\u7edf\u8ba1\u91cf\u9075\u5faa\u4ece\u805a\u5408\u6587\u6863\u4e2d\u63d0\u53d6\u7684\u6570\u503c\u7684\u96f6\u5047\u8bbe\u4e0b\u7684\u5b66\u751f t \u5206\u5e03\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"32-bucket-\u805a\u5408",children:"3.2 Bucket \u805a\u5408"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b98\u65b9\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket.html",children:"Bucket aggregations"})]}),"\n",(0,r.jsx)(n.p,{children:"\u5b58\u50a8\u6876\u805a\u5408\u4e0d\u4f1a\u50cf\u6307\u6807\u805a\u5408\u90a3\u6837\u8ba1\u7b97\u5b57\u6bb5\u7684\u6307\u6807\uff0c\u800c\u662f\u521b\u5efa\u6587\u6863\u5b58\u50a8\u6876\u3002\u6bcf\u4e2a\u5b58\u50a8\u6876\u90fd\u4e0e\u4e00\u4e2a\u6807\u51c6\uff08\u53d6\u51b3\u4e8e\u805a\u5408\u7c7b\u578b\uff09\u76f8\u5173\u8054\uff0c\u8be5\u6807\u51c6\u786e\u5b9a\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\u7684\u6587\u6863\u662f\u5426\u201c\u843d\u5165\u201d\u5176\u4e2d\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6876\u6709\u6548\u5730\u5b9a\u4e49\u4e86\u6587\u6863\u96c6\u3002\u9664\u4e86\u5b58\u50a8\u6876\u672c\u8eab\u4e4b\u5916\uff0cbucket\u805a\u5408\u8fd8\u8ba1\u7b97\u5e76\u8fd4\u56de\u201c\u843d\u5165\u201d\u6bcf\u4e2a\u5b58\u50a8\u6876\u7684\u6587\u6863\u6570\u91cf\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u4e0e\u805a\u5408\u76f8\u53cdmetrics\uff0c\u6876\u805a\u5408\u53ef\u4ee5\u4fdd\u5b58\u5b50\u805a\u5408\u3002\u8fd9\u4e9b\u5b50\u805a\u5408\u5c06\u9488\u5bf9\u7531\u5176\u201c\u7236\u201d\u5b58\u50a8\u6876\u805a\u5408\u521b\u5efa\u7684\u5b58\u50a8\u6876\u8fdb\u884c\u805a\u5408\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u6709\u4e0d\u540c\u7684\u5b58\u50a8\u6876\u805a\u5408\u5668\uff0c\u6bcf\u4e2a\u5b58\u50a8\u6876\u805a\u5408\u5668\u90fd\u6709\u4e0d\u540c\u7684\u201c\u5b58\u50a8\u6876\u201d\u7b56\u7565\u3002\u6709\u4e9b\u5b9a\u4e49\u5355\u4e2a\u5b58\u50a8\u6876\uff0c\u6709\u4e9b\u5b9a\u4e49\u56fa\u5b9a\u6570\u91cf\u7684\u591a\u4e2a\u5b58\u50a8\u6876\uff0c\u8fd8\u6709\u4e00\u4e9b\u5728\u805a\u5408\u8fc7\u7a0b\u4e2d\u52a8\u6001\u521b\u5efa\u5b58\u50a8\u6876\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-histogram-aggregation.html",children:"histogram"}),"\uff1a\u57fa\u4e8e\u591a\u6876\u503c\u6e90\u7684\u805a\u5408\uff0c\u53ef\u5e94\u7528\u4e8e\u4ece\u6587\u6863\u4e2d\u63d0\u53d6\u7684\u6570\u503c\u6216\u6570\u503c\u8303\u56f4\u503c\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-range-aggregation.html",children:"range"}),"\uff1a\u6309\u8303\u56f4\u8fdb\u884c\u5206\u6876\u3002"]}),"\n",(0,r.jsx)(n.li,{children:"\u66f4\u591a\u5730\u67e5\u770b\u5b98\u65b9\u6587\u6863\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'POST /sales/_search?size=0\n{\n  "aggs": {\n    "prices": {\n      "histogram": {\n        "field": "price",\n        "interval": 50\n      }\n    },\n    "price_ranges": {\n      "range": {\n        "field": "price",\n        "ranges": [\n          { "to": 100.0 },\n          { "from": 100.0, "to": 200.0 },\n          { "from": 200.0 }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'{\n  ...\n  "aggregations": {\n    "prices": {\n      "buckets": [\n        {\n          "key": 0.0,\n          "doc_count": 1\n        },\n        {\n          "key": 50.0,\n          "doc_count": 1\n        },\n        {\n          "key": 100.0,\n          "doc_count": 0\n        },\n        {\n          "key": 150.0,\n          "doc_count": 2\n        },\n        {\n          "key": 200.0,\n          "doc_count": 3\n        }\n      ]\n    },\n    "price_ranges": {\n      "buckets": [\n        {\n          "key": "*-100.0",\n          "to": 100.0,\n          "doc_count": 2\n        },\n        {\n          "key": "100.0-200.0",\n          "from": 100.0,\n          "to": 200.0,\n          "doc_count": 2\n        },\n        {\n          "key": "200.0-*",\n          "from": 200.0,\n          "doc_count": 3\n        }\n      ]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"33-pipeline-\u805a\u5408",children:"3.3 Pipeline \u805a\u5408"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b98\u65b9\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-pipeline.html",children:"Pipeline aggregations"})]}),"\n",(0,r.jsx)(n.p,{children:"\u7ba1\u9053\u805a\u5408\u4f5c\u7528\u4e8e\u5176\u4ed6\u805a\u5408\uff08\u800c\u4e0d\u662f\u6587\u6863\u96c6\uff09\u751f\u6210\u7684\u8f93\u51fa\uff0c\u4ece\u800c\u5c06\u4fe1\u606f\u6dfb\u52a0\u5230\u8f93\u51fa\u6811\u4e2d\u3002\u6709\u8bb8\u591a\u4e0d\u540c\u7c7b\u578b\u7684\u7ba1\u9053\u805a\u5408\uff0c\u6bcf\u79cd\u7c7b\u578b\u90fd\u8ba1\u7b97\u6765\u81ea\u5176\u4ed6\u805a\u5408\u7684\u4e0d\u540c\u4fe1\u606f\uff0c\u4f46\u8fd9\u4e9b\u7c7b\u578b\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Parent\uff1a\u4e00\u7cfb\u5217\u7ba1\u9053\u805a\u5408\uff0c\u63d0\u4f9b\u5176\u7236\u805a\u5408\u7684\u8f93\u51fa\uff0c\u5e76\u4e14\u80fd\u591f\u8ba1\u7b97\u65b0\u5b58\u50a8\u6876\u6216\u65b0\u805a\u5408\u4ee5\u6dfb\u52a0\u5230\u73b0\u6709\u5b58\u50a8\u6876\u3002"}),"\n",(0,r.jsx)(n.li,{children:"Sibling\uff1a\u7ba1\u9053\u805a\u5408\u63d0\u4f9b\u540c\u7ea7\u805a\u5408\u7684\u8f93\u51fa\uff0c\u5e76\u4e14\u80fd\u591f\u8ba1\u7b97\u4e0e\u540c\u7ea7\u805a\u5408\u5904\u4e8e\u540c\u4e00\u7ea7\u522b\u7684\u65b0\u805a\u5408\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"buckets_path"})," \u7ba1\u9053\u805a\u5408\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u53c2\u6570\u6765\u6307\u793a\u6240\u9700\u6307\u6807\u7684\u8def\u5f84\u6765\u5f15\u7528\u6267\u884c\u8ba1\u7b97\u6240\u9700\u7684\u805a\u5408\u3002\u5b9a\u4e49\u8fd9\u4e9b\u8def\u5f84\u7684\u8bed\u6cd5\u53ef\u4ee5\u5728 \u4e0b\u9762\u7684 ",(0,r.jsx)(n.code,{children:"buckets_path"})," \u8bed\u6cd5\u90e8\u5206\u627e\u5230\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u7ba1\u9053\u805a\u5408\u4e0d\u80fd\u6709\u5b50\u805a\u5408\uff0c\u4f46\u6839\u636e\u7c7b\u578b\uff0c\u5b83\u53ef\u4ee5\u5728 ",(0,r.jsx)(n.code,{children:"buckets_path"})," \u5141\u8bb8\u94fe\u63a5\u7ba1\u9053\u805a\u5408\u65f6\u5f15\u7528\u53e6\u4e00\u4e2a\u7ba1\u9053\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5c06\u4e24\u4e2a\u5bfc\u6570\u94fe\u63a5\u5728\u4e00\u8d77\u6765\u8ba1\u7b97\u4e8c\u9636\u5bfc\u6570\uff08\u5373\u5bfc\u6570\u7684\u5bfc\u6570\uff09\u3002"]}),"\n",(0,r.jsxs)(n.h4,{id:"buckets_path-\u8bed\u6cd5",children:[(0,r.jsx)(n.code,{children:"buckets_path"})," \u8bed\u6cd5"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5927\u591a\u6570\u7684\u7ba1\u9053\u805a\u5408\u9700\u8981\u53e6\u4e00\u4e2a\u7ba1\u9053\u805a\u5408\u4f5c\u4e3a\u4ed6\u4eec\u7684\u8f93\u5165\u3002\u8f93\u5165\u805a\u5408\u901a\u8fc7 ",(0,r.jsx)(n.code,{children:"buckets_path"})," \u53c2\u6570\u5b9a\u4e49\uff0c\u9700\u8981\u9075\u5faa\u4e0b\u9762\u7684\u683c\u5f0f\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"AGG_SEPARATOR       =  `>` ;\nMETRIC_SEPARATOR    =  `.` ;\nAGG_NAME            =  <the name of the aggregation> ;\nMETRIC              =  <the name of the metric (in case of multi-value metrics aggregation)> ;\nMULTIBUCKET_KEY     =  `[<KEY_NAME>]`\nPATH                =  <AGG_NAME><MULTIBUCKET_KEY>? (<AGG_SEPARATOR>, <AGG_NAME> )* ( <METRIC_SEPARATOR>, <METRIC> ) ;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f8b\u5982\uff0c\u8be5\u8def\u5f84 ",(0,r.jsx)(n.code,{children:'"my_bucket>my_stats.avg"'})," \u5c06\u6307\u5411\u5ea6\u91cf ",(0,r.jsx)(n.code,{children:"avg"})," \u4e2d\u7684\u503c ",(0,r.jsx)(n.code,{children:'"my_stats"'})," \uff0c\u8be5\u5ea6\u91cf\u5305\u542b\u5728 ",(0,r.jsx)(n.code,{children:'"my_bucket"'})," \u5b58\u50a8\u6876\u805a\u5408\u4e2d\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e9b\u4f8b\u5b50\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'multi_bucket["foo"]>single_bucket>multi_metric.avg'})," \u4f1a\u53d6\u591a\u6876\u805a\u5408 ",(0,r.jsx)(n.code,{children:'"multi_bucket"'})," \u4e2d\u7684  ",(0,r.jsx)(n.code,{children:'"foo"'})," \uff0c\u518d\u53d6 ",(0,r.jsx)(n.code,{children:'"single_bucket""foo"'})," \u4e2d\u7684\uff0c",(0,r.jsx)(n.code,{children:'"multi_metric"'})," \u7684\u805a\u5408 ",(0,r.jsx)(n.code,{children:"avg"})," \u7684\u6307\u6807\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'agg1["foo"]._count'})," \u5c06\u83b7\u53d6\u591a\u6876\u805a\u5408 ",(0,r.jsx)(n.code,{children:"multi_bucket"})," \u4e2d\u6876 ",(0,r.jsx)(n.code,{children:'"foo"'})," \u7684 ",(0,r.jsx)(n.code,{children:"_count"})," \u6307\u6807\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u8def\u5f84\u662f\u76f8\u5bf9\u4e8e\u7ba1\u9053\u805a\u5408\u7684\u4f4d\u7f6e\u800c\u8a00\u7684\uff1b\u5b83\u4eec\u4e0d\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u5e76\u4e14\u8be5\u8def\u5f84\u4e0d\u80fd\u8fd4\u56de\u805a\u5408\u6811\u201c\u5411\u4e0a\u201d\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u805a\u5408\u6307\u4ee4",children:"\u805a\u5408\u6307\u4ee4"}),"\n",(0,r.jsxs)(n.p,{children:["\u805a\u5408\u6307\u4ee4\u89c1",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-pipeline.html",children:"\u5b98\u65b9\u6587\u6863"}),"\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'POST _search\n{\n  "size": 0,\n  "aggs": {\n    "sales_per_month": {\n      "date_histogram": {\n        "field": "date",\n        "calendar_interval": "month"\n      },\n      "aggs": {\n        "sales": {\n          "sum": {\n            "field": "price"\n          }\n        }\n      }\n    },\n    "avg_monthly_sales": {\n// tag::avg-bucket-agg-syntax[]               \n      "avg_bucket": {\n        "buckets_path": "sales_per_month>sales",\n        "gap_policy": "skip",\n        "format": "#,##0.00;(#,##0.00)"\n      }\n// end::avg-bucket-agg-syntax[]               \n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'{\n  "took": 11,\n  "timed_out": false,\n  "_shards": ...,\n  "hits": ...,\n  "aggregations": {\n    "sales_per_month": {\n      "buckets": [\n        {\n          "key_as_string": "2015/01/01 00:00:00",\n          "key": 1420070400000,\n          "doc_count": 3,\n          "sales": {\n            "value": 550.0\n          }\n        },\n        {\n          "key_as_string": "2015/02/01 00:00:00",\n          "key": 1422748800000,\n          "doc_count": 2,\n          "sales": {\n            "value": 60.0\n          }\n        },\n        {\n          "key_as_string": "2015/03/01 00:00:00",\n          "key": 1425168000000,\n          "doc_count": 2,\n          "sales": {\n            "value": 375.0\n          }\n        }\n      ]\n    },\n    "avg_monthly_sales": {\n      "value": 328.33333333333333,\n      "value_as_string": "328.33"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"4\u68c0\u7d22api",children:"4.\u68c0\u7d22API"}),"\n",(0,r.jsx)(n.h3,{id:"41-\u6392\u5e8f",children:"4.1 \u6392\u5e8f"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b98\u65b9\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/sort-search-results.html",children:"Sort search results"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u5141\u8bb8\u60a8\u5728\u7279\u5b9a\u5b57\u6bb5\u4e0a\u6dfb\u52a0\u4e00\u79cd\u6216\u591a\u79cd\u6392\u5e8f\u3002\u6bcf\u79cd\u6392\u5e8f\u4e5f\u53ef\u4ee5\u98a0\u5012\u3002\u6392\u5e8f\u662f\u5728\u6bcf\u4e2a\u5b57\u6bb5\u7ea7\u522b\u5b9a\u4e49\u7684\uff0c ",(0,r.jsx)(n.code,{children:"_score"})," \u7684\u7279\u6b8a\u5b57\u6bb5\u540d\u79f0\u6309\u5206\u6570\u6392\u5e8f\uff0c ",(0,r.jsx)(n.code,{children:"_doc"})," \u6309\u7d22\u5f15\u987a\u5e8f\u6392\u5e8f\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /my-index-000001/_search\n{\n  "sort" : [\n    { "post_date" : {"order" : "asc", "format": "strict_date_optional_time_nanos"}},\n    "user",\n    { "name" : "desc" },\n    { "age" : "desc" },\n    "_score"\n  ],\n  "query" : {\n    "term" : { "user" : "kimchy" }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"42-\u5206\u9875",children:"4.2 \u5206\u9875"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b98\u65b9\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/paginate-search-results.html",children:"Paginate search results"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u641c\u7d22\u4f1a\u8fd4\u56de\u524d ",(0,r.jsx)(n.code,{children:"10"})," \u4e2a\u5339\u914d\u7ed3\u679c\u3002\u8981\u7ffb\u9605\u66f4\u5927\u7684\u7ed3\u679c\u96c6\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u641c\u7d22API \u7684 ",(0,r.jsx)(n.code,{children:"from"})," \u548c ",(0,r.jsx)(n.code,{children:"size"})," \u53c2\u6570\u3002",(0,r.jsx)(n.code,{children:"from"})," \u53c2\u6570\u5b9a\u4e49\u8981\u8df3\u8fc7\u7684\u547d\u4e2d\u6570\uff0c\u9ed8\u8ba4\u4e3a ",(0,r.jsx)(n.code,{children:"0"}),"\u3002 ",(0,r.jsx)(n.code,{children:"size"})," \u53c2\u6570\u662f\u8981\u8fd4\u56de\u7684\u6700\u5927\u547d\u4e2d\u6570\u3002\u8fd9\u4e24\u4e2a\u53c2\u6570\u4e00\u8d77\u5b9a\u4e49\u7ed3\u679c\u9875\u9762\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET twitter/_search\n{\n    "query": {\n        "match": {\n            "title": "elasticsearch"\n        }\n    },\n    "search_after": [1463538857, "654323"],\n    "sort": [\n        {"date": "asc"},\n        {"tie_breaker_id": "asc"}\n    ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"43-\u6309\u5b57\u6bb5\u53ec\u56de",children:"4.3 \u6309\u5b57\u6bb5\u53ec\u56de"}),"\n",(0,r.jsxs)(n.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u641c\u7d22\u54cd\u5e94\u4e2d\u7684\u6bcf\u4e2a\u547d\u4e2d\u90fd\u5305\u542b\u6587\u6863 ",(0,r.jsx)(n.code,{children:"_source"})," \uff0c\u5b83\u662f\u7d22\u5f15\u6587\u6863\u65f6\u63d0\u4f9b\u7684\u6574\u4e2a JSON \u5bf9\u8c61\u3002\u6709\u4e24\u79cd\u63a8\u8350\u7684\u65b9\u6cd5\u53ef\u4ee5\u4ece\u641c\u7d22\u67e5\u8be2\u4e2d\u68c0\u7d22\u9009\u5b9a\u7684\u5b57\u6bb5\uff1a"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"fields"})," \u9009\u9879\u63d0\u53d6\u7d22\u5f15\u6620\u5c04\u4e2d\u5b58\u5728\u7684\u5b57\u6bb5\u503c\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u9700\u8981\u8bbf\u95ee\u5728\u7d22\u5f15\u65f6\u4f20\u9012\u7684\u539f\u59cb\u6570\u636e\uff0c\u8bf7\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"_source"})," \u9009\u9879\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u60a8\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e24\u79cd\u65b9\u6cd5\uff0c\u4f46\u9996\u9009 fields \u9009\u9879\uff0c\u56e0\u4e3a\u5b83\u4f1a\u53c2\u8003\u6587\u6863\u6570\u636e\u548c\u7d22\u5f15\u6620\u5c04\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"fields"})," \u9009\u9879"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'POST my-index-000001/_search\n{\n  "query": {\n    "match": {\n      "user.id": "kimchy"\n    }\n  },\n  "fields": [\n    "user.id",\n    "http.response.*",         \n    {\n      "field": "@timestamp",\n      "format": "epoch_millis" \n    }\n  ],\n  "_source": false\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'{\n  "hits" : {\n    "total" : {\n      "value" : 1,\n      "relation" : "eq"\n    },\n    "max_score" : 1.0,\n    "hits" : [\n      {\n        "_index" : "my-index-000001",\n        "_id" : "0",\n        "_score" : 1.0,\n        "fields" : {\n          "user.id" : [\n            "kimchy"\n          ],\n          "@timestamp" : [\n            "4098435132000"\n          ],\n          "http.response.bytes": [\n            1070000\n          ],\n          "http.response.status_code": [\n            200\n          ]\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"_source"})," \u9009\u9879"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'GET /_search\n{\n  "_source": false,\n  // "_source": "obj.*",\n  // "_source": [ "obj1.*", "obj2.*" ],\n  // "_source": {\n  //   "includes": [ "obj1.*", "obj2.*" ],\n  //   "excludes": [ "*.description" ]\n  // },\n  // "stored_fields" : ["user", "postDate"],\n  "query": {\n    "match": {\n      "user.id": "kimchy"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"44-\u591a\u4e2a\u6570\u636e\u6d41\u6216\u7d22\u5f15\u9009\u62e9",children:"4.4 \u591a\u4e2a\u6570\u636e\u6d41\u6216\u7d22\u5f15\u9009\u62e9"}),"\n",(0,r.jsxs)(n.p,{children:["\u68c0\u7d22\u7d22\u5f15\u652f\u6301\u4e00\u5230\u591a\u4e2a\uff0c\u5bf9\u4e8e\u5355\u4e2a\u7d22\u5f15\u91c7\u7528 ",(0,r.jsx)(n.code,{children:"GET /{\u7d22\u5f15\u540d}/_search"})," \u683c\u5f0f\uff0c\u5bf9\u4e8e\u591a\u4e2a\u7d22\u5f15\u53ef\u91c7\u7528\u9017\u53f7\u6216\u901a\u914d\u7b26\u5339\u914d\uff0c\u4f8b\u5982 ",(0,r.jsx)(n.code,{children:"GET /order1,order2/_search"})," \u6216 ",(0,r.jsx)(n.code,{children:"GET /order*/_search"})," \u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"45-\u9ad8\u4eae",children:"4.5 \u9ad8\u4eae"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b98\u65b9\u6587\u6863\uff1a",(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/highlighting.html#highlighting",children:"Highlighting"})]}),"\n",(0,r.jsx)(n.p,{children:"\u9ad8\u4eae\u4f7f\u60a8\u80fd\u591f\u4ece\u641c\u7d22\u7ed3\u679c\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u6bb5\u4e2d\u83b7\u53d6\u7a81\u51fa\u663e\u793a\u7684\u7247\u6bb5\uff0c\u4ee5\u4fbf\u60a8\u53ef\u4ee5\u5411\u7528\u6237\u663e\u793a\u67e5\u8be2\u5339\u914d\u7684\u4f4d\u7f6e\u3002\u5f53\u60a8\u8bf7\u6c42\u9ad8\u4eae\u663e\u793a\u65f6\uff0c\u54cd\u5e94\u4f1a\u4e3a\u6bcf\u4e2a\u641c\u7d22\u547d\u4e2d\u5305\u542b\u4e00\u4e2a\u9644\u52a0\u7a81\u51fa\u663e\u793a\u5143\u7d20\uff0c\u5176\u4e2d\u5305\u62ec\u7a81\u51fa\u663e\u793a\u7684\u5b57\u6bb5\u548c\u7a81\u51fa\u663e\u793a\u7684\u7247\u6bb5\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"46-\u641c\u7d22\u6a21\u677f",children:"4.6 \u641c\u7d22\u6a21\u677f"}),"\n",(0,r.jsx)(n.p,{children:"\u641c\u7d22\u6a21\u677f\u662f\u4e00\u4e2a\u5b58\u50a8\u7684\u641c\u7d22\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u53d8\u91cf\u8fd0\u884c\u3002\u5982\u679c\u60a8\u4f7f\u7528 Elasticsearch \u4f5c\u4e3a\u641c\u7d22\u540e\u7aef\uff0c\u5219\u53ef\u4ee5\u5c06\u641c\u7d22\u680f\u4e2d\u7684\u7528\u6237\u8f93\u5165\u4f5c\u4e3a\u641c\u7d22\u6a21\u677f\u7684\u53c2\u6570\u4f20\u9012\u3002\u8fd9\u4f7f\u60a8\u53ef\u4ee5\u8fd0\u884c\u641c\u7d22\uff0c\u800c\u65e0\u9700\u5411\u7528\u6237\u516c\u5f00 Elasticsearch \u7684\u67e5\u8be2\u8bed\u6cd5\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'PUT _scripts/my-search-template\n{\n  "script": {\n    "lang": "mustache",\n    "source": {\n      "query": {\n        "match": {\n          "message": "{{query_string}}"\n        }\n      },\n      "from": "{{from}}",\n      "size": "{{size}}"\n    },\n    "params": {\n      "query_string": "My query string"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h1,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html",children:"Elasticsearch Guide"})}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var r=s(96540);const c={},i=r.createContext(c);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);