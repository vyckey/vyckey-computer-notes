"use strict";(self.webpackChunkvyckey_computer_notes=self.webpackChunkvyckey_computer_notes||[]).push([[5238],{10777:(s,e,i)=>{i.r(e),i.d(e,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var n=i(74848),t=i(28453);const a={title:"Distributed ID",tags:["distribution","id"],sidebar_label:"Distributed ID",sidebar_position:5},d="Distributed Lock",l={id:"distribution/distributed_id",title:"Distributed ID",description:"\u5b9e\u73b0\u65b9\u6848",source:"@site/middleware/distribution/distributed_id.md",sourceDirName:"distribution",slug:"/distribution/distributed_id",permalink:"/middleware/distribution/distributed_id",draft:!1,unlisted:!1,tags:[{label:"distribution",permalink:"/middleware/tags/distribution"},{label:"id",permalink:"/middleware/tags/id"}],version:"current",lastUpdatedBy:"vyckey",lastUpdatedAt:174745298e4,sidebarPosition:5,frontMatter:{title:"Distributed ID",tags:["distribution","id"],sidebar_label:"Distributed ID",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"CAP & BASE",permalink:"/middleware/distribution/theorem"},next:{title:"Distributed Lock",permalink:"/middleware/distribution/distributed_lock"}},r={},c=[{value:"\u5b9e\u73b0\u65b9\u6848",id:"\u5b9e\u73b0\u65b9\u6848",level:2},{value:"\u6570\u636e\u5e93ID\u6bb5",id:"\u6570\u636e\u5e93id\u6bb5",level:3},{value:"Redis\u81ea\u589eID",id:"redis\u81ea\u589eid",level:3},{value:"MongoDB\u7684ObjectId",id:"mongodb\u7684objectid",level:3},{value:"Snowflake\u7b97\u6cd5",id:"snowflake\u7b97\u6cd5",level:3},{value:"UUID",id:"uuid",level:3}];function m(s){const e={annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",math:"math",mn:"mn",mo:"mo",mrow:"mrow",msup:"msup",pre:"pre",semantics:"semantics",span:"span",ul:"ul",...(0,t.R)(),...s.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{id:"distributed-lock",children:"Distributed Lock"}),"\n",(0,n.jsx)(e.h2,{id:"\u5b9e\u73b0\u65b9\u6848",children:"\u5b9e\u73b0\u65b9\u6848"}),"\n",(0,n.jsx)(e.h3,{id:"\u6570\u636e\u5e93id\u6bb5",children:"\u6570\u636e\u5e93ID\u6bb5"}),"\n",(0,n.jsx)(e.h3,{id:"redis\u81ea\u589eid",children:"Redis\u81ea\u589eID"}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:"> incr key\n(integer) 2048\n"})}),"\n",(0,n.jsx)(e.h3,{id:"mongodb\u7684objectid",children:"MongoDB\u7684ObjectId"}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:"+-------------------+--------------------+--------------------+------------------+\n| timestamp(4bytes) | machine_id(4bytes) | process_id(2bytes) | sequence(3bytes) |\n+-------------------+--------------------+--------------------+------------------+\n"})}),"\n",(0,n.jsx)(e.h3,{id:"snowflake\u7b97\u6cd5",children:"Snowflake\u7b97\u6cd5"}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:"+------------+-------------------+----------------------+------------------+------------------+\n| sign(1bit) | timestamp(48bits) | datacenter_id(5bits) | worker_id(5bits) | sequence(13bits) |\n+------------+-------------------+----------------------+------------------+------------------+\n"})}),"\n",(0,n.jsxs)(e.ul,{children:["\n",(0,n.jsxs)(e.li,{children:["sign(1bit)\uff1a\u7b26\u53f7\u4f4d\uff08\u6807\u8bc6\u6b63\u8d1f\uff09\uff0c\u59cb\u7ec8\u4e3a ",(0,n.jsx)(e.code,{children:"0"}),"\uff0c\u4ee3\u8868\u751f\u6210\u7684 ID \u4e3a\u6b63\u6570\u3002"]}),"\n",(0,n.jsxs)(e.li,{children:["timestamp (41 bits)\uff1a\u7528\u6765\u8868\u793a\u65f6\u95f4\u6233\uff0c\u5355\u4f4d\u662f\u6beb\u79d2\uff0c\u53ef\u4ee5\u652f\u6491 ",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsxs)(e.mrow,{children:[(0,n.jsxs)(e.msup,{children:[(0,n.jsx)(e.mn,{children:"2"}),(0,n.jsx)(e.mn,{children:"4"})]}),(0,n.jsx)(e.mn,{children:"1"})]}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"2^41"})]})})}),(0,n.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.8141em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord",children:"2"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsx)(e.span,{className:"vlist-t",children:(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.8141em"},children:(0,n.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"4"})})]})})})})})]}),(0,n.jsx)(e.span,{className:"mord",children:"1"})]})})]})," \u6beb\u79d2\uff08\u7ea6 69 \u5e74\uff09\u3002"]}),"\n",(0,n.jsxs)(e.li,{children:["datacenter id + worker id (10 bits)\uff1a\u4e00\u822c\u6765\u8bf4\uff0c\u524d ",(0,n.jsx)(e.code,{children:"5"})," \u4f4d\u8868\u793a\u673a\u623f ID\uff0c\u540e ",(0,n.jsx)(e.code,{children:"5"})," \u4f4d\u8868\u793a\u673a\u5668 ID\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u533a\u5206\u4e0d\u540c\u96c6\u7fa4/\u673a\u623f\u7684\u8282\u70b9\u3002"]}),"\n",(0,n.jsxs)(e.li,{children:["sequence (12 bits)\uff1a\u8868\u793a\u5e8f\u5217\u53f7\uff0c\u5e8f\u5217\u53f7\u4e3a\u81ea\u589e\u503c\uff0c\u4ee3\u8868\u5355\u53f0\u673a\u5668\u6bcf\u6beb\u79d2\u80fd\u591f\u4ea7\u751f\u7684\u6700\u5927\u5e8f\u5217\u53f7\u6570(",(0,n.jsxs)(e.span,{className:"katex",children:[(0,n.jsx)(e.span,{className:"katex-mathml",children:(0,n.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(e.semantics,{children:[(0,n.jsxs)(e.mrow,{children:[(0,n.jsxs)(e.msup,{children:[(0,n.jsx)(e.mn,{children:"2"}),(0,n.jsx)(e.mn,{children:"1"})]}),(0,n.jsx)(e.mn,{children:"2"}),(0,n.jsx)(e.mo,{children:"="}),(0,n.jsx)(e.mn,{children:"4096"})]}),(0,n.jsx)(e.annotation,{encoding:"application/x-tex",children:"2^12=4096"})]})})}),(0,n.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.8141em"}}),(0,n.jsxs)(e.span,{className:"mord",children:[(0,n.jsx)(e.span,{className:"mord",children:"2"}),(0,n.jsx)(e.span,{className:"msupsub",children:(0,n.jsx)(e.span,{className:"vlist-t",children:(0,n.jsx)(e.span,{className:"vlist-r",children:(0,n.jsx)(e.span,{className:"vlist",style:{height:"0.8141em"},children:(0,n.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,n.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,n.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(e.span,{className:"mord mtight",children:"1"})})]})})})})})]}),(0,n.jsx)(e.span,{className:"mord",children:"2"}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.jsx)(e.span,{className:"mrel",children:"="}),(0,n.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,n.jsxs)(e.span,{className:"base",children:[(0,n.jsx)(e.span,{className:"strut",style:{height:"0.6444em"}}),(0,n.jsx)(e.span,{className:"mord",children:"4096"})]})]})]}),")\uff0c\u4e5f\u5c31\u662f\u8bf4\u5355\u53f0\u673a\u5668\u6bcf\u6beb\u79d2\u6700\u591a\u53ef\u4ee5\u751f\u6210 ",(0,n.jsx)(e.code,{children:"4096"})," \u4e2a\u552f\u4e00\u5e8f\u5217\u53f7\u3002"]}),"\n"]}),"\n",(0,n.jsx)(e.h3,{id:"uuid",children:"UUID"}),"\n",(0,n.jsx)(e.h1,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"})]})}function h(s={}){const{wrapper:e}={...(0,t.R)(),...s.components};return e?(0,n.jsx)(e,{...s,children:(0,n.jsx)(m,{...s})}):m(s)}},28453:(s,e,i)=>{i.d(e,{R:()=>d,x:()=>l});var n=i(96540);const t={},a=n.createContext(t);function d(s){const e=n.useContext(a);return n.useMemo((function(){return"function"==typeof s?s(e):{...e,...s}}),[e,s])}function l(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(t):s.components||t:d(s.components),n.createElement(a.Provider,{value:e},s.children)}}}]);